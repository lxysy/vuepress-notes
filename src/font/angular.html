<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>angular | 笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="笔记">
    
    <link rel="preload" href="/vuepress-notes/assets/css/0.styles.bb0cac51.css" as="style"><link rel="preload" href="/vuepress-notes/assets/js/app.0e02cffb.js" as="script"><link rel="preload" href="/vuepress-notes/assets/js/3.314e4ca8.js" as="script"><link rel="preload" href="/vuepress-notes/assets/js/1.db3018c9.js" as="script"><link rel="preload" href="/vuepress-notes/assets/js/8.617d334c.js" as="script"><link rel="prefetch" href="/vuepress-notes/assets/js/10.0d8b522a.js"><link rel="prefetch" href="/vuepress-notes/assets/js/11.45a89248.js"><link rel="prefetch" href="/vuepress-notes/assets/js/12.610a518b.js"><link rel="prefetch" href="/vuepress-notes/assets/js/13.31e5be6d.js"><link rel="prefetch" href="/vuepress-notes/assets/js/14.93afc766.js"><link rel="prefetch" href="/vuepress-notes/assets/js/15.60a83dff.js"><link rel="prefetch" href="/vuepress-notes/assets/js/16.7a913e32.js"><link rel="prefetch" href="/vuepress-notes/assets/js/17.0d11a26d.js"><link rel="prefetch" href="/vuepress-notes/assets/js/18.3cb02b49.js"><link rel="prefetch" href="/vuepress-notes/assets/js/19.91f74a73.js"><link rel="prefetch" href="/vuepress-notes/assets/js/20.db97b71e.js"><link rel="prefetch" href="/vuepress-notes/assets/js/21.6a3fd66e.js"><link rel="prefetch" href="/vuepress-notes/assets/js/22.7135889a.js"><link rel="prefetch" href="/vuepress-notes/assets/js/23.ec1d80e2.js"><link rel="prefetch" href="/vuepress-notes/assets/js/24.86bcefcd.js"><link rel="prefetch" href="/vuepress-notes/assets/js/25.0eab77f5.js"><link rel="prefetch" href="/vuepress-notes/assets/js/26.aa42e5ea.js"><link rel="prefetch" href="/vuepress-notes/assets/js/4.0fe247a7.js"><link rel="prefetch" href="/vuepress-notes/assets/js/5.09087305.js"><link rel="prefetch" href="/vuepress-notes/assets/js/6.9924d7dc.js"><link rel="prefetch" href="/vuepress-notes/assets/js/7.0b417e34.js"><link rel="prefetch" href="/vuepress-notes/assets/js/9.c4433b39.js">
    <link rel="stylesheet" href="/vuepress-notes/assets/css/0.styles.bb0cac51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>笔记</h3> <p class="description" data-v-59e6cb88>笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>FYShawn</span>
          
        <!---->
        2026
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-notes/" class="home-link router-link-active"><img src="/vuepress-notes/avator1.png" alt="笔记" class="logo"> <span class="site-name">笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-notes/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/rxjs/" class="nav-link"><i class="undefined"></i>
  rxjs
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/ant-design-pro/" class="nav-link"><i class="undefined"></i>
  ant-design-pro
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/mdbook/" class="nav-link"><i class="undefined"></i>
  mdbook
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/离线文档/" class="nav-link"><i class="undefined"></i>
  离线文档
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/vue原理/" class="nav-link"><i class="undefined"></i>
  vue原理
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/electron/" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/angular/" class="nav-link"><i class="undefined"></i>
  angular
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/垃圾回收/" class="nav-link"><i class="undefined"></i>
  垃圾回收
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/GC/" class="nav-link"><i class="undefined"></i>
  GC
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/下载依赖上传私有npm源/" class="nav-link"><i class="undefined"></i>
  下载依赖上传私有npm源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FYShawn 的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1838800372241005" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lxysy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vuepress-notes/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/vuepress-notes/avator1.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    FYShawn
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>16</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>14</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-notes/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/rxjs/" class="nav-link"><i class="undefined"></i>
  rxjs
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/ant-design-pro/" class="nav-link"><i class="undefined"></i>
  ant-design-pro
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/mdbook/" class="nav-link"><i class="undefined"></i>
  mdbook
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/离线文档/" class="nav-link"><i class="undefined"></i>
  离线文档
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/vue原理/" class="nav-link"><i class="undefined"></i>
  vue原理
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/electron/" class="nav-link"><i class="undefined"></i>
  electron
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/angular/" class="nav-link"><i class="undefined"></i>
  angular
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/垃圾回收/" class="nav-link"><i class="undefined"></i>
  垃圾回收
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/GC/" class="nav-link"><i class="undefined"></i>
  GC
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-notes/categories/下载依赖上传私有npm源/" class="nav-link"><i class="undefined"></i>
  下载依赖上传私有npm源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FYShawn 的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1838800372241005" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lxysy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vuepress-notes/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>angular</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>FYShawn</span>
          
        <!---->
        2026
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">angular</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>FYShawn</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2024/1/2</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>angular</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h1> <h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <div class="language- extra-class"><pre><code>Angular 应用是模块化的，它拥有自己的模块化系统，称作 `NgModule`。它可以包含一些组件、服务提供者或其它代码文件，其作用域由包含它们的 `NgModule` 定义。
</code></pre></div><h3 id="ngmodule-元数据"><a href="#ngmodule-元数据" class="header-anchor">#</a> @NgModule 元数据</h3> <p><code>NgModule</code> 是一个带有 <code>@NgModule()</code> 装饰器的类。<code>@NgModule()</code> 装饰器是一个函数，它接受一个元数据对象，该对象的属性用来描述这个模块。</p> <table><thead><tr><th>属性</th> <th></th></tr></thead> <tbody><tr><td>declarations</td> <td>那些属于本 NgModule 的<a href="https://angular.cn/guide/architecture-components" target="_blank" rel="noopener noreferrer">组件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<em>指令</em>、<em>管道</em>。</td></tr> <tr><td>exports</td> <td>那些能在其它模块的<em>组件模板</em>中使用的可声明对象的子集。</td></tr> <tr><td>imports</td> <td>那些导出了<em>本</em>模块中的组件模板所需的类的其它模块。</td></tr> <tr><td>providers</td> <td>本模块向全局服务中贡献的那些<a href="https://angular.cn/guide/architecture-services" target="_blank" rel="noopener noreferrer">服务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的创建器。这些服务能被本应用中的任何部分使用。（你也可以在组件级别指定服务提供者。）</td></tr> <tr><td>bootstrap</td> <td>应用的主视图，称为<em>根组件</em>。它是应用中所有其它视图的宿主。只有<em>根模块</em>才应该设置这个 <code>bootstrap</code> 属性</td></tr></tbody></table> <p>模块会其中的组件提供了一个编译上下文环境，属于这个 <code>NgModule</code> 的组件会共享同一个编译上下文环境。</p> <p>一个视图层次结构中可以混合使用由不同 <code>NgModule</code> 中的组件定义的视图</p> <h3 id="ngmodule-和-javascript-的模块"><a href="#ngmodule-和-javascript-的模块" class="header-anchor">#</a> NgModule 和 JavaScript 的模块</h3> <p>两种模块系统不同但<strong>互补</strong>，可同时使用</p> <h3 id="angular-自带的库"><a href="#angular-自带的库" class="header-anchor">#</a> Angular 自带的库</h3> <p>Angular 会作为一组 JavaScript 模块进行加载，使用import导入，每个 Angular 库的名称都带有 <code>@angular</code> 前缀。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入装饰器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token comment">// 导入angular模块</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/platform-browser'</span><span class="token punctuation">;</span>
<span class="token comment">// 使用导入的模块 把它加入 @NgModule 元数据的 imports 中</span>
@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">imports</span><span class="token operator">:</span> <span class="token punctuation">[</span>BrowserModule<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ol><li>创建组件class(@Component)</li> <li>在某个模块中注册组件class（declarations:[]）</li> <li>使用已经注册过的组件</li></ol> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <p>理想情况下，组件的工作只管用户体验，而不用顾及其它。它应该提供用于数据绑定的属性和方法，以便作为视图（由模板渲染）和应用逻辑（通常包含一些<em>模型</em>的概念）的中介者。</p> <h3 id="创建组件"><a href="#创建组件" class="header-anchor">#</a> 创建组件</h3> <p>到应用目录，执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 其中 &lt;component-name&gt; 是新组件的名字</span>
ng generate component <span class="token operator">&lt;</span>component<span class="token operator">-</span>name<span class="token operator">&gt;</span> 
</code></pre></div><h3 id="组件的元数据"><a href="#组件的元数据" class="header-anchor">#</a> 组件的元数据</h3> <blockquote><p>装饰器是一个对类进行处理的函数,装饰器本质就是编译时执行的函数</p></blockquote> <p>使用<code>@Component</code> 装饰器指出紧随其后的那个类是个组件类。</p> <p>组件的元数据告诉 Angular 到哪里获取它需要的主要构造块，以创建和展示这个组件及其视图，将<strong>模板</strong>和<strong>组件</strong>关联起来描述<strong>视图</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HeroListComponent是一个普通的类 直到给它加上了 @Component 装饰器，它才变成了组件</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">//一个 CSS 选择器 对应的标签</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span>    <span class="token string">'app-hero-list'</span><span class="token punctuation">,</span>
    
    <span class="token comment">//组件的 HTML 模板文件相对于这个组件文件的地址</span>
  <span class="token literal-property property">templateUrl</span><span class="token operator">:</span> <span class="token string">'./hero-list.component.html'</span><span class="token punctuation">,</span>
    <span class="token comment">//或直接使用template属性定义模板</span>
  <span class="token comment">// template:``</span>
    
    <span class="token comment">//引入外部的样式文件或直接使用styles属性</span>
    <span class="token comment">//styles 属性接受一个包含 CSS 规则的字符串数组</span>
   <span class="token literal-property property">styleUrls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./component-overview.component.css'</span><span class="token punctuation">]</span>
    <span class="token comment">//styles: ['h1 { font-weight: normal; }']</span>
    
    <span class="token comment">// 当前组件所需的服务提供者的一个数组</span>
  <span class="token literal-property property">providers</span><span class="token operator">:</span>  <span class="token punctuation">[</span> HeroService <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token comment">/* . . . */</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="组件生命周期"><a href="#组件生命周期" class="header-anchor">#</a> 组件生命周期</h3> <table><thead><tr><th style="text-align:left;">钩子方法</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;"><code>ngOnChanges()</code></td> <td>组件绑定的属性值发生变化</td></tr> <tr><td style="text-align:left;"><code>ngOnInit()</code></td> <td>组件初始化完毕（等同于vue.js的mounted）</td></tr> <tr><td style="text-align:left;"><code>ngDoCheck()</code></td> <td>组件检查到系统对自己的影响</td></tr> <tr><td style="text-align:left;"><code>ngAfterContentInit()</code></td> <td>组件内容（插槽）初始化完成</td></tr> <tr><td style="text-align:left;"><code>ngAfterContentChecked()</code></td> <td>组件内容（插槽）发生变化需要检查</td></tr> <tr><td style="text-align:left;"><code>ngAfterViewInit()</code></td> <td>组件视图（模板）初始化完成</td></tr> <tr><td style="text-align:left;"><code>ngAfterViewChecked()</code></td> <td>组件视图（模板）发生变化需要检查</td></tr> <tr><td style="text-align:left;"><code>ngOnDestroy()</code></td> <td>组件即将被从DOM树上销毁，资源释放</td></tr></tbody></table> <ul><li><p><code>ngOnChanges()</code></p> <p>所绑定的一个或多个<strong>输入属性</strong>（@Input）的值发生变化时都会调用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 输入属性name的值发生了改变.就会触发ngOnChanges()生命周期钩子.这个生命周期钩子被调用时会传入一个SimpleChanges对象,包含上一值、当前值、是否第一次改变</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>

<span class="token function">ngOnChanges</span><span class="token punctuation">(</span>changes<span class="token operator">:</span> SimpleChanges<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:SimpleChange {previousValue: &quot;a&quot;, currentValue: &quot;ab&quot;, firstChange: false}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注：当输入属性为引用类型时，当改变引用类型中的属性时，不会触发<code>ngOnChanges()</code>生命周期钩子.只有当你将你引用类型数据的指针指向另一块内存地址的时候才会触发<code>ngOnChanges()</code>生命周期钩子.</p></blockquote></li> <li><p><code>ngOnInit()</code></p> <ul><li><strong>只调用一次</strong></li> <li>在Angular第一次显示数据绑定和设置指令/组件的输入属性之后，初始化指令/组件(等同于mounted)</li></ul></li> <li><p><code>ngDoCheck()</code></p> <p>组件检查到了系统对自己的影响</p> <p><code>ngDoCheck()</code>是Angular中的<strong>变更检测机制</strong>.它由<code>zone.js</code>来实现的.其行为是只要你的Angular中的某个组件发生<strong>异步事件</strong>.就会检查整个组件树,以保证组件属性的变化或页面的变化是同步的.所以<code>ngDoCheck()</code>的触发相当频繁的.并且是无法预料的</p></li> <li><p><code>ngAfterContentInit()</code></p> <p>组件内容（插槽）初始化完成</p> <ul><li><p>第一次ngDoCheck()之后调用，<strong>只调用一次</strong>。</p></li> <li><p>当把内容投影进组件之后调用</p> <div class="language-html extra-class"><pre class="language-html"><code>// 父组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-child</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>我是父组件向子组件的投影内容&lt;/&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-child</span><span class="token punctuation">&gt;</span></span>


// 子组件 ChildComponent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  //接受父组件的投影内容
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-content</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-content</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p><code>ngAfterContentChecked()</code></p> <p>组件内容（插槽）发生变化需要检查</p> <ul><li><p>每次完成<strong>被投影组件内容</strong>的变更检测之后调用</p></li> <li><p><code>ngAfterContentInit()</code>在每次<code>ngDoCheck()</code>之后调用</p> <p>当父组件向子组件的投影内容发生改变时会调用。它与<code>ngDoCheck()</code>类似.当投影内容发生改变时,就会执行变更检查机制.同时调用<code>ngAfterContentChecked()</code>生命周期钩子。</p> <blockquote><p>**注意:**当父组件和子组件都有投影内容时,会先执行父组件的生命周期钩子</p></blockquote></li></ul></li> <li><p><code>ngAfterViewInit()</code></p> <p>组件视图初始化完成</p> <ul><li><p>初始化完组件视图及其子视图之后调用</p></li> <li><p>第一次<code>ngAfterContentChecked()</code>之后调用，<strong>只调用一次</strong></p> <p>当其组件本身和所有的子组件渲染完成,已经呈现在页面上时,调用<code>ngAfterViewInit()</code>生命周期钩子.</p></li></ul></li> <li><p><code>ngAfterViewChecked()</code></p> <p>组件视图发生变化需要检查</p> <ul><li><p>每次做完组件视图和子视图的变更检测之后调用</p></li> <li><p>ngAfterViewInit()和每次ngAfterContentChecked()之后调用。</p> <p>当组件及其子组件的视图发生改变时,执行完变更检查机制后调用.当父组件和子组件都发生视图变化时,会先执行子组件的生命周期钩子.</p> <blockquote><p><strong>注意:</strong> 这里所说的视图发生改变不一定是真正页面上的变化.只是Angular种所认为的视图变化.因为Angular本身并不能察觉到页面上显示的视图.所以在Angular认为,只要你在后台定义的<strong>属性</strong>发生了改变,就是视图有了变化.从而就会调用<code>ngAfterViewChecked()</code>生命周期钩子.</p></blockquote></li></ul></li> <li><p><code>ngOnDestroy()</code></p> <ul><li>当Angular每次销毁指令/组件之前调用并清扫。 在这儿反订阅可观察对象和分离事件处理器，以防内存泄漏。</li> <li>在Angular销毁指令/组件之前调用,<strong>只调用一次</strong></li></ul></li></ul> <h3 id="视图封装"><a href="#视图封装" class="header-anchor">#</a> 视图封装</h3> <p><code>Component</code> 的装饰器提供了 <a href="https://angular.cn/api/core/Component#encapsulation" target="_blank" rel="noopener noreferrer"><code>encapsulation</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项，可用来控制如何基于<strong>每个组件</strong>应用视图封装。</p> <ul><li><code>ViewEncapsulation.Emulated</code>：使用垫片（shimmed) CSS 来模拟原生行为(默认)。组件的样式会添加到文档的 <code>&lt;head&gt;</code> 中，选择器只会影响它们各自组件模板中的元素。</li> <li><code>ViewEncapsulation.None</code> ：使用不带任何封装的全局 CSS。组件的样式会添加到文档的 <code>&lt;head&gt;</code> 中，响文档中的任何匹配元素。</li> <li><code>ViewEncapsulation.ShadowDom</code>：使用 Shadow DOM v1，封装样式。会影响全局样式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">encapsulation</span><span class="token operator">:</span> ViewEncapsulation<span class="token punctuation">.</span>None<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果该策略设置为 <code>ViewEncapsulation.Emulated</code>，并且该组件没有指定 <code>styles</code> 或 <code>styleUrls</code>，就会自动切换到 <code>ViewEncapsulation.None</code>。</p> <h3 id="组件之间的交互"><a href="#组件之间的交互" class="header-anchor">#</a> 组件之间的交互</h3> <h4 id="输入性属性绑定"><a href="#输入性属性绑定" class="header-anchor">#</a> 输入性属性绑定</h4> <p>父-&gt;子</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 父组件模板 输入型属性 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-hero-child</span>
      <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let hero of heroes<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">[hero]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">[master]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>master<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-hero-child</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 子组件 @Input</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroChildComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> hero<span class="token operator">!</span><span class="token operator">:</span> Hero<span class="token punctuation">;</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token string">'master'</span><span class="token punctuation">)</span> masterName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>@<a href="https://angular.cn/api/core/Input" target="_blank" rel="noopener noreferrer">Input<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(<a href="https://angular.cn/api/core/Input#bindingPropertyName" target="_blank" rel="noopener noreferrer"><code>bindingPropertyName?</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)可为子组件属性名指定别名</p> <h4 id="setter截听输入属性变化"><a href="#setter截听输入属性变化" class="header-anchor">#</a> setter截听输入属性变化</h4> <p>在<code>@input</code>后使用setter,拦截父组件中值的变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">NameChildComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">name</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'&lt;no name set&gt;'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> _name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ngonchanges-截听输入属性变化"><a href="#ngonchanges-截听输入属性变化" class="header-anchor">#</a> <code>ngOnChanges()</code> 截听输入属性变化</h4> <blockquote><p>当需要监视多个、交互式输入属性的时候，本方法比用属性的 setter 更合适。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">VersionChildComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnChanges</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> major <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> minor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token literal-property property">changeLog</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
  <span class="token function">ngOnChanges</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">changes</span><span class="token operator">:</span> SimpleChanges</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">log</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> propName <span class="token keyword">in</span> changes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>
</code></pre></div><h4 id="父组件监听子组件的事件"><a href="#父组件监听子组件的事件" class="header-anchor">#</a> 父组件监听子组件的事件</h4> <p>子组件暴露一个 <code>EventEmitter</code> 属性，使用<code>@Output</code>装饰器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 子组件</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'app-voter'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    ...
    &lt;button type=&quot;button&quot; (click)=&quot;vote(false)&quot; [disabled]=&quot;didVote&quot;&gt;Disagree&lt;/button&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">VoterComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> voted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  didVote <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token function">vote</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">agreed</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>voted<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>agreed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>didVote <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 父组件</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'app-vote-taker'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    ...
    &lt;app-voter
      *ngFor=&quot;let voter of voters&quot;
      [name]=&quot;voter&quot;
      (voted)=&quot;onVoted($event)&quot;&gt;
    &lt;/app-voter&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">VoteTakerComponent</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token function">onVoted</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">agreed</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="父组件访问子组件方法、属性"><a href="#父组件访问子组件方法、属性" class="header-anchor">#</a> 父组件访问子组件方法、属性</h4> <p><strong>本地变量</strong>(不建议使用)</p> <p>在<strong>父组件模板</strong>里，新建一个本地变量来代表子组件，然后利用这个变量来读取子组件的属性和调用子组件的方法(<em>父组件本身的代码对子组件没有访问权</em>)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父组件  在子组件模板上使用 #变量名 ，之后在模板中通过该变量访问子组件属性和方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CountdownTimerComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./countdown-timer.component'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'app-countdown-parent-lv'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;h3&gt;Countdown to Liftoff (via local variable)&lt;/h3&gt;
    &lt;button type=&quot;button&quot; (click)=&quot;timer.start()&quot;&gt;Start&lt;/button&gt;
    &lt;button type=&quot;button&quot; (click)=&quot;timer.stop()&quot;&gt;Stop&lt;/button&gt;
    &lt;div class=&quot;seconds&quot;&gt;{{timer.seconds}}&lt;/div&gt;
    &lt;app-countdown-timer #timer&gt;&lt;/app-countdown-timer&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">styleUrls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'../assets/demo.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CountdownLocalVarParentComponent</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p><strong>父级调用<code>@ViewChild()</code></strong></p> <p>子组件作为 <em>ViewChild</em>(视图查询)，<strong>注入</strong>到父组件里面</p> <blockquote><p>由<em>本地变量</em>切换到 <em>ViewChild</em> 技术的唯一目的就是做示范</p></blockquote> <p>导入<code>@ViewChild</code>属性装饰器，<a href="https://angular.cn/api/core/AfterViewInit" target="_blank" rel="noopener noreferrer">AfterViewInit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>生命周期钩子</p> <p>使用<code>@ViewChild</code>注入到父组件的私有属性中</p> <p>被注入的子组件只有在 Angular 显示了父组件视图之后才能访问，先让父组件显示，若子组件需要更改父组件数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AfterViewInit<span class="token punctuation">,</span> ViewChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CountdownTimerComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./countdown-timer.component'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'app-countdown-parent-vc'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;h3&gt;Countdown to Liftoff (via ViewChild)&lt;/h3&gt;
    &lt;button type=&quot;button&quot; (click)=&quot;start()&quot;&gt;Start&lt;/button&gt;
    &lt;button type=&quot;button&quot; (click)=&quot;stop()&quot;&gt;Stop&lt;/button&gt;
    &lt;div class=&quot;seconds&quot;&gt;{{ seconds() }}&lt;/div&gt;
    &lt;app-countdown-timer&gt;&lt;/app-countdown-timer&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">styleUrls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'../assets/demo.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CountdownViewChildParentComponent</span> <span class="token keyword">implements</span> <span class="token class-name">AfterViewInit</span> <span class="token punctuation">{</span>
    @<span class="token function">ViewChild</span><span class="token punctuation">(</span>CountdownTimerComponent<span class="token punctuation">)</span>
    <span class="token keyword">private</span> timerComponent<span class="token operator">!</span><span class="token operator">:</span> CountdownTimerComponent<span class="token punctuation">;</span>

  	<span class="token function">seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">seconds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timerComponent<span class="token punctuation">.</span>seconds<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 若在AfterViewInit中更新父组件视图，单向数据流规则会阻止在同一个周期内更新父组件视图，要更新父组件视图要再等一轮</span>
        <span class="token comment">// this.seconds = () =&gt; this.timerComponent.seconds</span>
    <span class="token punctuation">}</span>

 	<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timerComponent<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  	<span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timerComponent<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="父组件和子组件通过服务来通讯"><a href="#父组件和子组件通过服务来通讯" class="header-anchor">#</a> 父组件和子组件通过服务来通讯</h4> <p>该服务实例的作用域被限制在父组件和其子组件内。这个组件子树之外的组件将无法访问该服务或者与它们通讯。</p> <p>服务内部：</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MissionService</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>父组件</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">providers</span><span class="token operator">:</span> <span class="token punctuation">[</span>MissionService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MissionControlComponent</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">missionService</span><span class="token operator">:</span> MissionService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>子组件</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MissionControlComponent</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">missionService</span><span class="token operator">:</span> MissionService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="组件样式"><a href="#组件样式" class="header-anchor">#</a> 组件样式</h3> <p>会定义一个空的 <code>styles</code> 数组</p> <div class="language-js extra-class"><pre class="language-js"><code>ng generate component hero<span class="token operator">-</span>app <span class="token operator">--</span>inline<span class="token operator">-</span>style
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 组件内部样式 接受一个包含 CSS 代码的字符串数组</span>
    <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>注意：这些样式<strong>只对当前组件生效</strong>。它们<strong>既不会作用于模板中嵌入的任何组件</strong>，也不会作用于投影进来的组件（如 <code>ng-content</code>）。</p></blockquote> <p><strong>特殊选择器</strong></p> <p>每个组件都会关联一个与其组件选择器相匹配的元素。这个元素称为<strong>宿主元素</strong></p> <ul><li><p><code>:host</code></p> <p>创建针对宿主元素自身的样式，而不是针对宿主内部的那些元素</p></li> <li><p><code>:host-context</code></p> <p>在当前组件宿主元素的<em>祖先节点</em>中查找 CSS 类，直到文档的根节点为止。它只能与其它选择器组合使用</p></li> <li><p><code>::ng-deep</code></p> <p>为了把指定的样式限定在当前组件及其下级组件中，请确保在 <code>::ng-deep</code> 之前带上 <code>:host</code> 选择器。如果 <code>::ng-deep</code> 组合器在 <code>:host</code> 伪类之外使用，该样式就会污染其它组件。</p></li></ul> <p><strong>引入外部样式</strong></p> <ul><li><p><code>styleUrls</code></p> <blockquote><p>当使用 CLI 进行构建时，要确保这个链接到的样式表文件被复制到了服务器上</p></blockquote></li> <li><p>模板中的<code>link</code>标签</p></li></ul> <h3 id="数据绑定"><a href="#数据绑定" class="header-anchor">#</a> 数据绑定</h3> <p>DOM   Component</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 插值</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// 组件传值 属性绑定 子组件通过@Input接收</span>
<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;value&quot;</span>

<span class="token comment">// 事件绑定</span>
<span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;handler&quot;</span>

<span class="token comment">// 双向数据绑定</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;hero-name&quot;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>ngModel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;hero.name&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>Angular 在每个 JavaScript 事件循环中处理<em>所有的</em>数据绑定，它会从组件树的根部开始，递归处理全部子组件。</p> <h3 id="管道"><a href="#管道" class="header-anchor">#</a> 管道</h3> <p>带有 <code>@Pipe</code> 装饰器的类中会定义一个转换函数，用来把输入值转换成供视图显示用的输出值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>interpolated_value <span class="token operator">|</span> pipe_name<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// 管道可传参</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Default format<span class="token operator">:</span> output <span class="token string">'Jun 15, 2015'</span><span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Today is <span class="token punctuation">{</span><span class="token punctuation">{</span>today <span class="token operator">|</span> date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fullDate format<span class="token operator">:</span> output <span class="token string">'Monday, June 15, 2015'</span><span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>The date is <span class="token punctuation">{</span><span class="token punctuation">{</span>today <span class="token operator">|</span> date<span class="token operator">:</span><span class="token string">'fullDate'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> shortTime format<span class="token operator">:</span> output <span class="token string">'9:43 AM'</span><span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>The time is <span class="token punctuation">{</span><span class="token punctuation">{</span>today <span class="token operator">|</span> date<span class="token operator">:</span><span class="token string">'shortTime'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre></div><h3 id="内容投影-vue插槽"><a href="#内容投影-vue插槽" class="header-anchor">#</a> 内容投影（vue插槽）</h3> <p>内容投影是一种模式，你可以在其中插入或<em>投影</em>要在另一个组件中使用的内容</p> <ul><li><p>单槽内容投影     从单一来源接受内容     <code>&lt;ng-content&gt;</code></p></li> <li><p>多槽内容投影     从多个来源接受内容</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'app-zippy-multislot'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    Default:
    &lt;ng-content&gt;&lt;/ng-content&gt;

    Question:
    &lt;ng-content select=&quot;[question]&quot;&gt;&lt;/ng-content&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ZippyMultislotComponent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-zippy-multislot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">question</span><span class="token punctuation">&gt;</span></span>
    Is content projection cool?
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Let's learn about content projection!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-zippy-multislot</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>条件内容投影    使用条件内容投影的组件仅在满足特定条件时才渲染内容</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-example-zippy</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appExampleZippyToggle</span><span class="token punctuation">&gt;</span></span>Is content project cool?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">appExampleZippyContent</span><span class="token punctuation">&gt;</span></span>
    It depends on what you do with it.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-example-zippy</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p><code>&lt;ng-content&gt;</code>元素是一个占位符，它不会创建真正的 DOM 元素。用于组件内部，且内部不能包含其他标签。</p> <p><code>&lt;ng-template&gt;</code>元素定义了默认情况下不呈现的模板,需要使用结构化指令指示 Angular 渲染它。主要用途之一是保存结构化指令将使用的模板内容</p> <p><code>&lt;ng-container&gt;</code>允许我们使用结构化指令，而不需要任何额外的元素</p></blockquote></li></ul> <h3 id="动态组件"><a href="#动态组件" class="header-anchor">#</a> 动态组件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// AdBannerComponent</span>
<span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;div class=&quot;ad-banner-example&quot;&gt;
    &lt;h3&gt;Advertisements&lt;/h3&gt;
    &lt;ng-template adHost&gt;&lt;/ng-template&gt;
  &lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><p>定义指令告诉 Angular 要把组件插入到什么地方</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ViewContainerRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'[adHost]'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AdDirective</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> <span class="token literal-property property">viewContainerRef</span><span class="token operator">:</span> ViewContainerRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AdBannerComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ads<span class="token operator">:</span> AdItem<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  currentAdIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment">//视图查询</span>
  @<span class="token function">ViewChild</span><span class="token punctuation">(</span>AdDirective<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> adHost<span class="token operator">!</span><span class="token operator">:</span> AdDirective<span class="token punctuation">;</span>
  <span class="token literal-property property">interval</span><span class="token operator">:</span> number<span class="token operator">|</span><span class="token keyword">undefined</span><span class="token punctuation">;</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentAdIndex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentAdIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ads<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">const</span> adItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ads<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentAdIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">//视图容器</span>
    <span class="token keyword">const</span> viewContainerRef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adHost<span class="token punctuation">.</span>viewContainerRef<span class="token punctuation">;</span>
    viewContainerRef<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建宿主视图（当用 createComponent() 方法实例化组件时创建）</span>
    <span class="token keyword">const</span> componentRef <span class="token operator">=</span> viewContainerRef<span class="token punctuation">.</span>createComponent<span class="token operator">&lt;</span>AdComponent<span class="token operator">&gt;</span><span class="token punctuation">(</span>adItem<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    componentRef<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>data <span class="token operator">=</span> adItem<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getAds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>@ViewChild</strong>:属性装饰器，用于配置一个视图查询。 变更检测器会在视图的 DOM 中查找能匹配上该选择器的第一个元素或指令。 如果视图的 DOM 发生了变化，出现了匹配该选择器的新的子节点，该属性就会被更新。</p> <blockquote><p>视图：视图是可显示元素的最小分组单位，它们会被同时创建和销毁。 Angular 在一个或多个<a href="https://angular.cn/guide/glossary#directive" target="_blank" rel="noopener noreferrer">指令 (directive)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的控制下渲染视图。</p> <p><a href="https://angular.cn/guide/glossary#component" target="_blank" rel="noopener noreferrer">组件 (component)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类及其关联的<a href="https://angular.cn/guide/glossary#template" target="_blank" rel="noopener noreferrer">模板 (template)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>定义了一个视图。视图由一个与该组件相关的 <code>ViewRef</code> 实例表示。 直属于某个组件的视图叫做<em>宿主视图</em>。</p> <p>视图中各个元素的属性可以动态修改以响应用户的操作，而这些元素的结构（数量或顺序）则不能。你可以通过在它们的视图容器中插入、移动或移除内嵌视图来修改这些元素的结构</p></blockquote> <h3 id="angular元素"><a href="#angular元素" class="header-anchor">#</a> angular元素</h3> <p><em>Angular 元素</em>就是打包成<em>自定义元素</em>的 Angular 组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Injector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createCustomElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/elements'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PopupService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./popup.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PopupComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./popup.component'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'my-popup'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">injector</span><span class="token operator">:</span> Injector<span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token literal-property property">popup</span><span class="token operator">:</span> PopupService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 `PopupComponent` 转化为自定义元素.</span>
    <span class="token keyword">const</span> PopupElement <span class="token operator">=</span> <span class="token function">createCustomElement</span><span class="token punctuation">(</span>PopupComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span>injector<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在浏览器上注册自定义元素</span>
    customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'popup-element'</span><span class="token punctuation">,</span> PopupElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-popup</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Use Angular!<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-popup</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>customElements.define为浏览器API，参数为元素的名称，以及定义了元素功能的类</p> <p>组件内部输入属性@<a href="https://angular.cn/api/core/Input" target="_blank" rel="noopener noreferrer">Input<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>('myInputProp')   ===&gt;  自定义元素<code>my-input-prop</code> 属性</p> <p>组件内部输出属性@<a href="https://angular.cn/api/core/Output" target="_blank" rel="noopener noreferrer">Output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>() valueChanged = new <a href="https://angular.cn/api/core/EventEmitter" target="_blank" rel="noopener noreferrer">EventEmitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>()   ===&gt;  自定义元素@valueChanged事件</p></blockquote> <h2 id="模板"><a href="#模板" class="header-anchor">#</a> 模板</h2> <h3 id="插值"><a href="#插值" class="header-anchor">#</a> 插值</h3> <h3 id="属性绑定"><a href="#属性绑定" class="header-anchor">#</a> 属性绑定</h3> <p><code>[attr.]=&quot;&quot;</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">[attr.attribute-you-are-targeting]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expression<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="类和样式绑定"><a href="#类和样式绑定" class="header-anchor">#</a> 类和样式绑定</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 绑定类</span>
<span class="token comment">// 绑定到单个 CSS class</span>
<span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">.</span>sale<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;onSale&quot;</span>

<span class="token comment">// 绑定到多个 CSS 类 </span>
<span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;classExpression&quot;</span>
</code></pre></div><p>classExpression可以是：</p> <ul><li><code>'class class class'</code></li> <li><code>{ class:boolean }</code></li> <li><code>[class,class]</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 绑定样式</span>
<span class="token comment">// 绑定单一样式</span>
<span class="token operator">&lt;</span>nav <span class="token punctuation">[</span>style<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;expression&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">&gt;</span>

<span class="token comment">// 绑定多个样式</span>
<span class="token operator">&lt;</span>nav <span class="token punctuation">[</span>style<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;expression&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">&gt;</span>
</code></pre></div><p>expression格式：</p> <ul><li>样式的字符串列表，比如 <code>&quot;width: 100px; height: 100px; background-color: cornflowerblue;&quot;</code>。</li> <li>一个对象，其键名是样式名，其值是样式值，比如 <code>{width: '100px', height: '100px', backgroundColor: 'cornflowerblue'}</code>。</li></ul> <h3 id="事件绑定"><a href="#事件绑定" class="header-anchor">#</a> 事件绑定</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- v-on --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onSave=$event<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="属性绑定-2"><a href="#属性绑定-2" class="header-anchor">#</a> 属性绑定</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- v-bind --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[src]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>itemImageUrl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Notice the colSpan property is camel case --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">[colSpan]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1 + 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Three-Four<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="双向绑定"><a href="#双向绑定" class="header-anchor">#</a> 双向绑定</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-sizer</span> <span class="token attr-name">[(size)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fontSizePx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-sizer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//为了使双向数据绑定有效  @Input()属性为 size   则@Output()属性必为sizeChange</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SizerComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  size<span class="token operator">!</span><span class="token operator">:</span> number <span class="token operator">|</span> string<span class="token punctuation">;</span>
  @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> sizeChange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="管道-2"><a href="#管道-2" class="header-anchor">#</a> 管道</h3> <blockquote><p>类似于过滤器</p></blockquote> <p>在模板中使用简单函数格式化文本</p> <p><strong>内置管道</strong></p> <ul><li><a href="https://angular.cn/api/common/DatePipe" target="_blank" rel="noopener noreferrer"><code>DatePipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：根据本地环境中的规则格式化日期值。</li> <li><a href="https://angular.cn/api/common/UpperCasePipe" target="_blank" rel="noopener noreferrer"><code>UpperCasePipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：把文本全部转换成大写。</li> <li><a href="https://angular.cn/api/common/LowerCasePipe" target="_blank" rel="noopener noreferrer"><code>LowerCasePipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：把文本全部转换成小写。</li> <li><a href="https://angular.cn/api/common/CurrencyPipe" target="_blank" rel="noopener noreferrer"><code>CurrencyPipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：把数字转换成货币字符串，根据本地环境中的规则进行格式化。</li> <li><a href="https://angular.cn/api/common/DecimalPipe" target="_blank" rel="noopener noreferrer"><code>DecimalPipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：把数字转换成带小数点的字符串，根据本地环境中的规则进行格式化。</li> <li><a href="https://angular.cn/api/common/PercentPipe" target="_blank" rel="noopener noreferrer"><code>PercentPipe</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：把数字转换成百分比字符串，根据本地环境中的规则进行格式化。</li></ul> <p><strong>管道优先级</strong></p> <p>管道 &gt; 三目运算符</p> <p><code>a ? b : c | x</code>    =》 <code>a ? b : (c | x)</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The hero's birthday is {{ birthday | date }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The hero's birthday is {{ birthday | date:&quot;MM/dd/yy&quot; }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The hero's birthday is {{ birthday | date | uppercase}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="模板变量"><a href="#模板变量" class="header-anchor">#</a> 模板变量</h3> <p>用井号 <code>#</code> 来声明一个模板变量，可以在组件模板中的任何地方引用某个模板变量</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">#phone</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phone number<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>callPhone(phone.value)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Call<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在组件上声明，该变量就会引用该组件实例</p> <p>在html标签上声明，该变量就会引用该元素</p> <p>在<code>&lt;ng-template&gt;</code>上声明，该变量就会引用一个 <code>TemplateRef</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">#itemForm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ngForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(ngSubmit)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onSubmit(itemForm)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ngModel</span> <span class="token attr-name">required</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[hidden]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!itemForm.form.valid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ submitMessage }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>模板变量作用域</strong></p> <p><code>*ngIf</code> <code>*ngFor</code>  结构指令  <code>&lt;ng-template&gt;</code>会创建新的词法范围，外部无法访问内部的模板变量</p> <p><strong>模板输入变量</strong></p> <p>入变量的 <code>let-</code> 声明的右侧可以指定应该用于该变量的值</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">ngFor</span> <span class="token attr-name">let-hero</span> <span class="token attr-name">let-i</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[ngForOf]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Hero number {{i}}: {{hero.name}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h2> <p>Angular 的模板是<em>动态的</em>。当 Angular 渲染它们的时候，会根据<em>指令</em>给出的指示对 DOM 进行转换。指令就是一个带有 <code>@Directive()</code> 装饰器的<strong>类</strong>，为 Angular 应用程序中的元素添加额外行为的类。</p> <table><thead><tr><th>指令类型</th> <th>详情</th></tr></thead> <tbody><tr><td>组件</td> <td>带有模板的指令。这种指令类型是最常见的指令类型</td></tr> <tr><td>属性型指令</td> <td>更改元素、组件或其他指令的外观或行为的指令。</td></tr> <tr><td>结构型指令</td> <td>通过添加和删除 DOM 元素来更改 DOM 布局。</td></tr></tbody></table> <p><strong>组件</strong>从技术角度上说就是一个<strong>指令</strong>，但是由于组件对 Angular 应用来说非常独特、非常重要，因此 Angular 专门定义了 <strong><code>@Component()</code> 装饰器</strong>，它使用一些面向模板的特性<strong>扩展了 <code>@Directive()</code> 装饰器</strong>。</p> <p>指令通常作为属性出现在元素标签上</p> <h3 id="内置属性型指令"><a href="#内置属性型指令" class="header-anchor">#</a> 内置属性型指令</h3> <p>属性型指令会监听并修改其它 HTML 元素和组件的行为、Attribute 和 Property</p> <ul><li><p><code>NgClass</code> 添加和删除一组 CSS 类。</p> <div class="language-html extra-class"><pre class="language-html"><code>// 与表达式一起使用
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[ngClass]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isSpecial ? 'special' : ''<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>This div is special<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

// 与方法一起使用
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[ngClass]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentClasses<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>This div is initially saveable, unchanged, and special.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 该对象的每个键（key）都是一个 CSS 类名。如果键为 true，则 ngClass 添加该类。如果键为 false，则 ngClass 删除该类。</span>
<span class="token literal-property property">currentClasses</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> boolean<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* . . . */</span>
<span class="token function">setCurrentClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentClasses <span class="token operator">=</span>  <span class="token punctuation">{</span>
    <span class="token literal-property property">saveable</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canSave<span class="token punctuation">,</span>
    <span class="token literal-property property">modified</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isUnchanged<span class="token punctuation">,</span>
    <span class="token literal-property property">special</span><span class="token operator">:</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>isSpecial
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>NgStyle</code> 添加和删除一组 HTML 样式。</p> <div class="language-html extra-class"><pre class="language-html"><code>// 设置内联样式
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[ngStyle]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentStyles<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  This div is initially italic, normal weight, and extra large (24px).
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">currentStyles</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* . . . */</span>
<span class="token function">setCurrentStyles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// CSS styles: set per current state of component properties</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentStyles <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'font-style'</span><span class="token operator">:</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>canSave      <span class="token operator">?</span> <span class="token string">'italic'</span> <span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'font-weight'</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isUnchanged <span class="token operator">?</span> <span class="token string">'bold'</span>   <span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'font-size'</span><span class="token operator">:</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>isSpecial    <span class="token operator">?</span> <span class="token string">'24px'</span>   <span class="token operator">:</span> <span class="token string">'12px'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>NgModdel</code>将双向数据绑定添加到 HTML 表单元素。</p> <p>导入 <code>FormsModule</code>，并将其添加到 NgModule 的 <code>imports</code> 列表中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> FormsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/forms'</span><span class="token punctuation">;</span> <span class="token comment">// &lt;--- JavaScript import from Angular</span>
<span class="token comment">/* . . . */</span>
@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/* . . . */</span>

  <span class="token literal-property property">imports</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    BrowserModule<span class="token punctuation">,</span>
    FormsModule <span class="token comment">// &lt;--- import into the NgModule</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">/* . . . */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>在 HTML 的 <code>&lt;form&gt;</code> 元素上添加 <code>[(ngModel)]</code> 绑定，并将其设置为等于此属性，这里是 <code>name</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;example-ngModel&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">(</span>ngModel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token punctuation">[</span><span class="token punctuation">(</span>ngModel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;currentItem.name&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;example-ngModel&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>若要自定义配置，要该表单将属性绑定（v-bind）和事件绑定( v-on )分开</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>input <span class="token punctuation">[</span>ngModel<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;currentItem.name&quot;</span> <span class="token punctuation">(</span>ngModelChange<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">&quot;setUppercaseName($event)&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;example-uppercase&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>要将 <code>[(ngModel)]</code> 应用于非表单型内置元素或第三方自定义组件，必须编写一个值访问器。</p></blockquote> <p>以下示例演示了如何使用输入元素激活默认值访问器（在这种情况下为文本字段）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> firstNameControl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token punctuation">[</span>formControl<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;firstNameControl&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>默认情况下，此值访问器用于 <code>&lt;input type=&quot;text&quot;&gt;</code> 和 <code>&lt;textarea&gt;</code> 元素，但你也可以将其用于具有类似行为且不需要特殊处理的自定义组件。为了将默认值访问器附加到自定义元素，请添加 <code>ngDefaultControl</code> 属性，如下所示。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>custom-input-component</span> <span class="token attr-name">ngDefaultControl</span> <span class="token attr-name">[(ngModel)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>custom-input-component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="创建属性型指令"><a href="#创建属性型指令" class="header-anchor">#</a> 创建属性型指令</h3> <div class="language-js extra-class"><pre class="language-js"><code>ng generate directive highlight
</code></pre></div><p><strong>定义</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> ElementRef<span class="token punctuation">,</span> HostListener <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'[appHighlight]'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HighlightDirective</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> appHighlight <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> defaultColor <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">el</span><span class="token operator">:</span> ElementRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  @<span class="token function">HostListener</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">)</span> <span class="token function">onMouseEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>appHighlight <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultColor <span class="token operator">||</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">HostListener</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">)</span> <span class="token function">onMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">highlight</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">color</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>nativeElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>ElementRef</code>: 用来访问DOW,<code>ElementRef</code> 的 <code>nativeElement</code> 属性会提供对宿主 DOM 元素的直接访问权限</p> <p>在指令的 <code>constructor()</code> 中添加 <code>ElementRef</code> 以<a href="https://angular.cn/guide/dependency-injection" target="_blank" rel="noopener noreferrer">注入<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>对宿主 DOM 元素的引用，该元素就是 <code>appHighlight</code> 的作用目标。</p> <p><code>@HostListener</code>: 处理用户事件</p> <p><strong>使用</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 带[]的表示绑定的值，引号里面是变量，不带[]的就是那个值 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">[appHighlight]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Highlight me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">appHighlight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>red<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Highlight me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAsQAAACYCAYAAADjhv8mAAAfZUlEQVR4nO3dvXPbWJrv8R8luedBz3QV0BsMESKkNpIyK1ToztzZdDjhnf9gJ7yT7YYbbngn68luhw7lYGekaMUQVbtbBU15u4GqeeEpW7Y2eADihaQsye2WSXw/VW6SIF4OQLv6x8MH50xevXp1IwAAAGCk9h67AQAAAMBjIhADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGDUCMQAAAEaNQAwAAIBRIxADAABg1AjEAAAAGLWDx24AgB/fzc3NYzcB2FmTyeSxmwDgR0YgBnbIzc2N3r17p7dv3+rm5oZgDPyIJpOJJpOJ9vf3tbe3RzAGdgiBGNgRNzc3ur6+1v7+vpIk0Weffab9/f3HbhawM96+favXr1/rL3/5i66vr3VwcEAoBnbE5NWrV3QhATvg7du3kqRf/vKXj9wSYPf9+c9/liS+dAI7gpvqgB1wc3OjN2/e6IsvvnjspgCj8MUXX+jNmzeUJQE7gkAM7ICbmxu9fv1an/3sZ4/dFGAUPvvZz/T69WsCMbAjCMTADmh6iA/4+Rb4SRzs79NDDOwQAjGwA3x0Cf7HDPyU3r1jJBdgVxCIgR1xI/7HDPyU+DcH7A4CMbAj6KkCflr8mwN2B+MQAxid3/3ud/rtb3977+3iOJYkVVV1722fP3+mr7/+RnEcy8zutW2SJIrNdFUVWizufeiNokg/6v7ucrzZ7Hh5HQHgU0EgBjA6WZbp9PSpzBKFUMoskaS1z0MoVZZBFxcXvSCcZZmybHrrtl0nx6c6PX2qOE7vHYiXx9TsQdsBAG5HIAYwOqenp5rNZr3Qu1h4T+zwuVmi7777VhcXF719PDs91bPnz5UktnHbhpn38E6n2U99qgCAOyAQAxid6XR6r5/tz89Wg2yaZUqzTLPsbiH3ob3CAICPj0AMYJTuE1CjJFq7PDUj6ALADmCUCQD4ACGEx24CAOADEYgB4APQQwwA249ADAAfgB5iANh+BGIA+AD0EAPA9iMQA8AHoIcYALYfgRgAPgA9xACw/QjEAPBem+c3pocYALYfgRgYuybQdYPdYz+/7+NHf75+HGIlkXr9w7edy32f32XdTa8f63oBwJYiEANj1ISmZZip2uWfwnPb0LZNyz/689UeYpO0KMrbt33fvlWtLu+e4/va11yT5vlyv1q9Th/rGjXHb/4QkAFsIWaqA0apkGzeX2T1cqU8HzxfLF6uXMGgS8liybJbtpVk9etbn3e2673WHdo3OE6vy3rYlo9wjVauSyYLmURtNYAtQiAGRqeS7A8K4d8kkVvuplxZYvZ7SRc/fVM+YSFIZv8sKa2f85cLwHYgEAMjZcr9yT1+4Q5W/0J+y7L3vd5G0ZqLFIJJIV+5fg853124RpJkFkuaS+GUMAxgqxCIgVHq9niG5X/XRZju8ia0rVumO76+j+5xNrXvrtt/yD4X6+6psyAlq/u56/k+ZJuHMd3rW88DBTNZqO7/IQHAJ4Cb6gBI2pxj1i1/eOYZbnn7a9v4zsOO9tB9rh1jIkgq7V772dSO+61530/koWH4LsftvLsy2MUOdHkDGA0CMTB6psFdVxse37eO7vD+MCRten3bPu4Tqu+7/T3isklRcpfj3OXYt637vmu2adnQXc7zrp/V+8NyUzJBMAawDSiZAEYq3BKsbPle6BRU9NcZrhvMVFwFaRGkYMqyMFj/Ia0LKgqv4Y2XgyXcFqKDgoKqyrRYBEVRkJkUW7tOUFBRmapSytIgsyDrbL+6341N1KKUQuyhrwzeTj9ed/t1+2yONVznHse/t037fsgxO38rzGRhTfGJ31VHLTGArUAgBkYoBHloVFBYaFnQmkiyxJ9bZ92yLg9oYqqZFEX+2OSd6iooP5eqYIrToOxD2lcftyil+YXv7ySpbz67dat6uzwoL6Q4lQ4zdTbysJyfB10Vkp1KWdq8E97XJzzgd8KFIOVzqSy9xzjrHW9TS5svE23Lty02VqG+sVBBcbym/QRhAFuEQAyMTAimopAuLqQ8l4pCqippOvUwlx1KxzPPM0FSnpvm86A8DyoKk0JQOpWyY+loJlnmYWghaZ57b2kapGrW9JQ+pI3SfC6dnUl5HpRlHmxv218Tos/n0vxcevFCOj2Vsqn34jZ9sotSyuvzzw6lkNTB/t43n9Xheh708sJUFEEnJ1I8labx7VsOe6S3MTqez6X80r8QnBxLs6eDOuK6hxgAtgE1xMDoVKqqSJKpyE1nZ9K338aa59LVVXc9DzNlCCpL6TKXXpwFvTj352UhFdXq+sOnD417ZSEVuWk+99B+V6HwoH9xUYf9q2FzvD+2yWrlMsStLyK59VghqAqmPA9tO++8k7Dm2fa4KqSXL/2LR15odYY6wjCALUIPMTAypliz2UKxSaEMygvT1VWlLJWeHnlPrNU1sCbvLU5iX5Zfesg5Pg46OZayWRs2Ews6fdYex3tzHzbkl5nvOys8aCp4ecdtHa/N4bIjKSs6t6nFtiyHMElJIp1+FXR4KE0zUxqHZcnCfSNcHHtv8NmZfNI6k0L1/u0aVefSbFN+9F8OvKSlLExlGRQqk3U/IHqIAWwRAjEwNvVNZFESlB1KyUuPg2kalGbNz/1tkI1NShP/E0W+LI2lOLPOzWp1iO3N5PuwMNxsaYmUph40g4IivT9jmSSLPPTKpFCttiGu657Tp7bs1bx/uYTqOmtTkgYlicnyevvB9dskyHunw0JKovfVR396TB7+m1EkLA6STes3g3Tr1xcA+LRQMgGMUqK4U5Br9egI3ZvPhixte1EtWR/4uoOH3b8AYR1rhjLwV3dIjN0xg3s9lsMxjkO3V/gBbQ39F9bk6+pu+wtBys+l4koqF6sVB58yU1N33d5gGapO93jYpmgPAARiYHyCSSpVdX6v3zS+wkpGa/LpmvrXJiJ3H29txqZjDNeyfvi+U27sDpGxZkvT3TJbkA8nt9h0jMFsFGZa9hB3B1UbquoRNC7qGwDD1YYVb2nXXZZ1l99lNOPblg/XMfMvHMvRRqbDlbYo4QMYPQIxMFK9HuI62Fno9vGuWleyMJzWIWx8t96H7hqGu1u0xx/uY9Mm64bG7W0bhtHeVtdp1lts2lF/+boe4pWRhs1UFqb5RTOKhk+kHcJdr8f6a7rS7s7a/TbcPnBdd4TkYOv/PnjJjZemxHUv/Mr009QPA9gi1BADIxWqNfHLbo+qy7IAmaJOfKqCj8Obz329JJFmT5sJG1wVvGb2Klfb41rKBz+uJWaK4+A1wO1RJQUvK6iHicsLKUmladoOEbdpYItmrNxmWLailIq5t+foSEoz64XjEHz/ZdW2L8/XX4/u2MXNGqV8+Ln5XPVkHdIs85sE/VSCrioPwnnu28zPfcPs2OuzB6fQu85F4fuOU7/ZMU2ky3PpKvjIHFnqx0oTv5nwMq+v+aL+XGbBa7O716g+77L0UTlK+WgdQV7HPc2C0s5Yw80nH8e+33Yikt6FJxQD2BoEYmCkLO6EvNANu8tFfWW9Xf1y0VmrDB6Gv3vh72WZB69uPirrmtmX83Y/ZdkeM0l9Rrk0lU5O/ABNlA11j+/5pQ+n9uKFB7WnT03pNChNBtmrez6drssyaNkzW1TeS54kYTmqRjMJybwess1MChceQIcWCw/bw1rpq8ID6Lff+tjEUST96ldeXjDLpKuqDvW5j//cBOPldTjpnkvbXxskFYXp4izo/9fnP5v5WMov62tSFH7tTkvJvgo+/NyZ9N13fq3TTPrm63U3QPqXgPncx2muKh/yriiDDo+lp6W3q5mwxeQhOEnqdifdvxlN0wnDALYHgRgYrVj17/sK8jAURVKRq+21rXtIq6KdxCNJpFAGRZ0f4xOTcnnIbEaD6FXvBml+Jl3k3qubxf6Te1lIZ+deSzuTFGfe89lkqSbPLhbeq5ul9WxwqXR2KV1dBc0vTHYS+pN2WPdp286onrq5qjy0qp5yudm2KKWLF34eaerBfiEpLKQ/DK6e1872yzmKou5RjaWvvwk6r4P3xUu/blnWDik3KzyYp1kbbJv3+8UbnXOpP5erKz9+Vd/DdjTz3tqLC79WL15Kcf0lYZZJ9rwN3ufnfr5NIG7qmctcmpoUHfo5Z5kPeZfPvRlppn7PctL2EEdNW3ujTBCIAWwPAjEwUt2b6soyVlFVuryUylQKc49isbXPi04vphJpUf9E3u0hDWX787vU9m+WwcPw+bn066/b0oAi8+VF7j/9S77czHs0l/sPfuNfmgQdTqVy5iEuz6X5PGg203KUr2U5Rug/MflYxlPzUR3K0ssMss5aRW46u/Be6unUdHTkJRFNacNQb7i2UAfUOvAeRt6kF2ceVGdFW0WQJtLsWLL/588PDz0Uxys9w/2q7EjBr/3C6t51f+/4qB4T2rw3OM9Ns1nQ0UzKZqbjk6AXL7x987kH72bvZfAvG3nhbTme1X8npt6Os7OgopBmM+9Nb3JuJO/VD8tF9SgTyzsWKZkAsD0IxMBIxZ2SiSSplE1Nx8dBWbpaLrEopbl5oJX6PZhWL2huslos/M9yjbpuuCwkBZNZWA6Nlpj3piaJB9mk3oekutux7oFOpDgNXocrKa2XFblPDBGqdnKN5bBrNsxj3qudJF5i0WTcpDkBBV3lXmaQppKitj64O5TbkFn7Zzqte1kjr4VOU9/X2ZmWZR/Nuk0JSv96avk1o301OJZ8POjmhrbDzK9pElSPK+091XFsSrOgNPV9TDMPwkUdzBU8t17l3kPftE8v/DhXQSrysPxyk+f+xaMZpzqeBlnhbbB1Qw4ThgFsEQIxMFqxFotmPAGfmCPLTFkWevXEZvUUyMGWE3O0N9W1mpnaFgv/Ob+rqUsNdQ9nk5WsDtLNSAWqA/K6AQu65QRB9TaJVIWgUut/oB+O/BXHQYX6PbtNyUQIHsrLTTsbWnPjXpJISSZN6y8b8bQZzSPUPd6d9ZNO4+LONem2f/naPCRbO7GImSmxoDgOy07ZbNruJ0qCLGknT0njznVuzj74Z5PnWo5DXZSSIu/tlzzkr55zkEVe3iJtyL7cVAdgixCIgRFrAu5y2DXrh9UmNkaRerPSSWH92LxSrzt1uUUdgkMzcoOGxQDeU9vEp145cBPwFh76hiNKLBbq9bZ2rY1jsSQLyzkkks5KTZBfbNhfTz3kWrc8ZOWYkX+JaEbmWCyC96hakMr+F4eqsmWQXm1/6F1Lqd7HsOu6HhM4isLGa+J7a/ffjBByfOz1xumsf4Pl0ZG/SJK2rKVzuEG3fLfxhGEA24NADIzNyoCx/fe61avSaqi0TomB1q2zWF2/qQu2uP4pvpSsrj9d1DWocazejXFtxqqPVYc9b5sviySVw97WjrVL6yBs9TBizUgUzZeBLPNlVSFVmcni0CsB6e/d2hEqNrVg4b25IbQBtgmby/1WkqW3fC4afEno7GPtusue4O5K7WfW/BVoqqu9M9dLPLJOr28IUpaGNtt2knJiUqh7j9eWlNBDDGCLMDEHMDbrpmiz/nvLl911ks1BrLso6oS+Zj/NEGE+Zq6pmPvoC0VR/zRv3kOZHbf7WSzb0e3PHC6re0oXthpIl3lscL6DetduZstm3o5mOLRyEVRUt4RPC8tvD93e9aa9TVBsbn5T2Vmh29sa26Ctw/jbiupG96fa7rwnLUP/agHGusVBoQqqKlMpKTZbfjGxpkSjOWYYfBZRW8qygjAMYIsQiIHRWqamZflAUzrRjz3rhJWe4EazuK2J9fCWHfrIDVHiE1Nc5R6KkyYMp4Pyhc6tZb3RHCQFM1nSHVGivQFuuWzZmblSkdw/k07JQ1wPjTad+vJ8LlV5O7zZym6Cp8W6k3gQnNeUlXR757slDVUYtLVfnrJ81kwjHfyOuPU51G774FZOoQnXRRF0lXtfd/MLQXPVr6r2xsVlGO72/G+qIQaALUHJBDBasRZ1KF6O+zuohx3qDQTW+Z18c/7ytU0+q9phFrSQqSw9LCYmTQ+lp3EzMcfwaM2z3pFlISiU3oSFtOxtDeoNTrFSpzzc71CkdvzhEKS8aifSWN2NLQNunU+XJR3rjmjWDlFnpn4Psa1v6VB35j9ZWMmcC3lvdAiSJeb1KHHbhtUdyr92xPXsd7F0ero+5OaF1eUT3aIV71FeWzBCDzGALUIgBkaqqkLnJ/07bFD3aC5XXWh92Fp09mmdKZPnHjCn9dTMzc/xST1axDA/rXZAh5Vn3Smgu3XP3fVWYtmGEoggr22+vGzLX5sb/dZnO0/BTTmEhX6ZiFQH0qgpNQn9tnRuqitL720N6XLLtbr9x+/7zMJghQ3fNbycJTO9vAqa59K33/oYyYkki01FFZYbpEnzJSBoXvg0z4uFj6M8HQ69Rg0xgC1CIAZGKo6DFou6BzfWyuxyw0riqvtmPTTXypqdm8W6vaVFKc1zL0HInnrpRNKMcCFJpSlYaMsPOrsPnfQbhj2Xi/XBcNE2e1kOMrRueZn7LG+HU2mameI0KFE9LvGAlxushvR2v6s30fXUPcSLRT1V8pW0CKYk7V+H1UZuekMbr0e3XcPPOc2kk+Ogly99Rr0il05y7yWXgorCy1yeP++X1BRzn4a7LPw846OgXhEHYRjAFiEQA2NjQVdXUp7HurjwWciKPNZ8Xi3Hqc3SZpg1U15I8wuflKMZS/d8Xv8kfxJ8xrnKw25RevCKIl/ncDAVcVF64LSL0C6vC3CTyG+8m514jrw895/xy9Innji78PdLmSoFFXVtbwgettN6Qo3Lcym/9EKNovBez3jqbSoX0vllXQJhdZlAKtmszW+RpPxKyq+CLi782PM1M9UFSVdXsfJ55dew8P2lmWRTKYl8uurLy/rcC5+xTpH3PCexn09RSmcvJJ1Is6POiA6dgo8mwM5z/9O0P76UZkc+g19Z+gQbReGf0+Wl99pGkYfuPPfPsazHHT57IR2f1LXAmen0WdDluU8L3RwjTXxyj1kmJZH1pqqugk+2EoI8pHe/ATF1M4AtQyAGRiaEUAemoPk8qCxNSVIpz72GNEnqkQVSSQrK64B0cdGUQfjrZr3o2OoZ3vzGq0U9LfL83ENflvrMbV5i4MG6mSlNaupr/dgnpQfZLPUb77x8IaiqpPNz88AeBVWFTzVc1qM25HlQPvf95UUz0YRvd3nps7SlU/+JP+/cJJfnUpb7NMVJIqmeJOTiog330vpxiRcLU1lUygvvVa2upDzyLwZTk0Jqyou2XT5tsp+bMr+BbzaTijPpYu6z8GVVN0Z2bykMHkBzD91BHkavEml+FlQeSir9y0D33Oapn5NKaV5fsxDq8J77qBpZJs2O/HAm6ezMlOdBpXnt9vGJvz8cI7n9+7Ru4d1v7AOATwGBGBgZM1OS+sgOSWJ6euo3qFk9wkISt9Mnm3xZVD+WQdKifn0Y6pnYgqaZdCLvLV5EPoNaVg+z1oxgkGX9G7aGQSpUfsBQBtnMQ5iZHzMyaWpBad1TWcRB33wtFcHroJvAmybS8aE/npz4jXpTa88hyaTTr6TDYw+5USIdHfUnyMgyD6rdUR/OLqTf/9vwSgYlqR8jTTvtTJu2eA1tmkqnISgxn346zdqe1pNTnwwjr6TjI293v2/Vv0gE81CczqTndZC2RMpiP6c0kRaZdKr23NLE2xVnkjI/11n9GXpb2lIQC77eaSzNsqAi+EQolphmR6GdTltt+2ZH9Ux1pQ+X553CcbtDEjGALTJ59erVzWM3AsCHub6+1vc//KB/PDy8w9qVpH9WCP+qsKaQdjiF8LI2Nmxeb7hOE3ibx/O5FArvdT6e9ffdTJmc51JVeJnDs2ce1tYesz5wqMLydfe5mlEWOm1Ybi//qX8YyM3qso/ch4M7OvKprJtz+vZb6Te/6bfln/5J+uYbn+p6uK/udVl5rzeeb7+etxsh20hZh+LBNR4eb/jeuhLe3vv1fNUrQ9p11m3X6Z7Rarv93ebE/68U/s/mRuyQ/7i81D98+aUODuhbArYd/4qBsVmOnRt6Q4E1hhGmW9J62+BgNlgntuanfdPLs6Bp3M6Cpk5otHrggiqWd1+mbY/tujxlISzLLJrRG5bDtXXe627f3U2/drltb557mUcI0tHT0NvH+lzXXo2V9zuJu7kObfvlPb6hP5jcxuveGf23Obdu0O9tb+u273xqzTXrHH/TJ+qfS/e9dm1b0961OwCALUEgBkap+Q08vD/Y1Gzw2Ahr3uuu09wAt4i9bKGoJ3NobvaKovpmvcp/1o/UvxFv3XH6x+rH9LVBsLedL++uV1VSVfgNhs0Qcc0eomh9nWwUBVmntKTf2M4IGnUNcLdf3EJ/u3t/Bra6fHORQr8WWWp7qNet/7623DnmMuwagC1CIAZGqblLbFgYcX/rfk7vvW9+o1qe13+uTHHsvdNR5BN1SEGReQ/ybNb+VN+0bNgj2Y9Z/bDZXz7conM3X1vUoDhuepubmwdN6YU0nfq6FxcbTr40WTzc31DoPd7WK7za1nX7XP+ZbY6e7Xmu266/Tv/I3eXvb/fgHcIwgC1CIAbGxjYFog/e8dpFFvkMdZLp6sp7YRcLUxRZXY4QZIlpakFxbF7+ENr93a9l9+3fbOsO0kyalUFF5YG4LKvl++ViwzVLhvt8f2u9ZGHDx7C2rZv2eZ8rc5d1bc2z9tV9e7PpIQawTfYeuwEAHkdQ1r5Yjg7w4z6aYqWx6fQr01dfmZ49m/pIFnWpQRxLaTrVyVGqw2NTNhs0stnfumPc9/m67ZtVFGt2JJ2exPrNr2OdPq2Upt4vbSYl0eo2Umduknse2/TAtt71OHdddtvx7nu9LR78nSIMA9ge9BADYxNMshOZriSd1Mv00R5NPkGEzUzTaak4lqoqklmsNC0Ux4miqJDZs8FNXOr/ur/uF//7PO88hrBQFYJiM1WdY0aJZME0zSpZZcva4TzPJfXrJhaLmYoy1aY+09hMVWd6v9hMtpy67u5t7bnrdndddtvxHnC9/UrMCMMAtg6BGBgbM3kQHnbHflw+2UekNG3ql+sZI5TIfLLln0wIQYtFpaJYPw9yFFk90kUlKdbl5R80DMRVNVNZfCWFtqe0O5xb0VnXTFKSKLZYds8ikK0T0rYgm2AMYEsQiIFRivXj1A3fjy2P3W3HcNnHd375nb77w3fL18Nxi4eP87xY2cd8nuv3v3/RG/lh0/jHslgnxzOdnn4lix94rutmM/mYHnq84Zh3ALAFCMTAWH1KgeUn7k18+XKuf/nXlann7uXFi5eSXt55/fDrXys7OtEsjmUPONcQwoO2+yCf0t8RAPiICMQAHt+WBK+joyOl9XzHZ2dnqqrVmf7e56Gh9icPwwAwIgRiAKN0n4oAHx4u1vHxsWbZTEFBRVHoYuMAxauaQ1VVpfihZRMAgI+CYdcAjM4sm+n09Nmdg2maZvrm66/1/PlznT471dHRkZLk/iMkx6KnFwA+RfQQAxidbJbp9OREIZQqy6AQKpnFGx+Pj4/1/Fe/0vHxsUI9XNssO1Qxu7p1O0nL51mWKUqMQAwAn6DJq1evbh67EQA+zPX1tb7/4Qf94+HhYzdlK1RVpSIvVJQ+ekRzw9qmxyiSsuxQZqY4jhVC0Hw+V1EUt27XfczSTNksIxDvkP+4vNQ/fPmlDg7oWwK2HYEY2AEEYuCnRyAGdgc1xAAAABg1AjEAAABGjUAMAACAUSMQAwAAYNQIxAAAABg1AjEAAABGjUAMAACAUSMQAwAAYNQIxAAAABg1AjEAAABGjUAMAACAUSMQAwAAYNQIxAAAABg1AjEAAABGjUAMAACAUSMQAztiMpnozfX1YzcDGIU319eaTCaP3QwAPxICMbAj9vb29Le//vWxmwGMwt/++lft7fG/UGBX8K8Z2AGTyUQH+wf6z//678duCjAK//lf/62D/QN6iYEdQSAGdsBkMtHBwb7+/ve/6d//+Cf9z/ff6/WbN4/dLGCnvH7zRv/z/ff69z/+SX//+990cLBPIAZ2xMFjNwDAh5tMJnry5Im++OIL/fBDqT/+6VzX19d69+7dYzcN2Bl7e3s6ODjQzz//XF9+mejJkycEYmBHEIiBHbAMxL/4hSaTiaLI9Pr1G719+1Y3NzeP3Txg600mE+3v7+uzz57o888/1y9+/nMCMbBDCMTAjtjb25OZaX9/Xz///HO9e3ejG90QiIEfwWQy0UQT7e1NdHBwoCdPnnBTHbBDCMTADtnb29Nnn32mJ0+eSBJhGPgRNb3Bk8mEnmFgxxCIgR3D/6wBALgffu8BAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIwagRgAAACjRiAGAADAqBGIAQAAMGoEYgAAAIzaQVVVj90GAAAA4NEcxHGs169f6/r6Wm/fvtW7d+90c3Pz2O0CAAAAPrrJZKL/BQmVA6QUFcFBAAAAAElFTkSuQmCC" alt="image-20230104163549985"></p> <h3 id="内置结构型指令"><a href="#内置结构型指令" class="header-anchor">#</a> 内置结构型指令</h3> <p>通过添加、移除或替换 DOM 元素来修改布局</p> <table><thead><tr><th style="text-align:left;">常见的内置结构型指令</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://angular.cn/guide/built-in-directives#ngIf" target="_blank" rel="noopener noreferrer"><code>NgIf</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">有条件地从模板创建或销毁子视图。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/guide/built-in-directives#ngFor" target="_blank" rel="noopener noreferrer"><code>NgFor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">为列表中的每个条目重复渲染一个节点。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/guide/built-in-directives#ngSwitch" target="_blank" rel="noopener noreferrer"><code>NgSwitch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">一组在备用视图之间切换的指令。</td></tr></tbody></table> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-hero-detail</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectedHero<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-hero-detail</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 当 isActive 表达式返回真值时，NgIf 会把 Component 添加到 DOM 中。当表达式为假值时，NgIf 会从 DOM 中删除 Component 并销毁该组件及其所有子组件。--&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let hero of heroes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of items; let i=index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{i + 1}} - {{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>结构型指令简写形式</strong></p> <p>应用结构指令时，它们通常以星号 <code>*</code> 为前缀，例如 <code>*ngIf</code>。本约定是 Angular 解释并转换为更长形式的速记。Angular 会将结构指令前面的星号转换为围绕宿主元素及其后代的 <code>&lt;ng-template&gt;</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{hero.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">[ngIf]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{hero.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>错误用法：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{hero.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 什么都不会被渲染出来 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">[ngIf]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{hero.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>正确用法：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">[ngIf]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{hero.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>*ngFor</code> 中的星号的简写形式与非简写的 <code>&lt;ng-template&gt;</code> 形式进行比较：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 
index ：元素索引
first ：是否为第一个元素
last ：是否为最后一个元素
even ：是否为偶数元素
odd ：是否为奇数元素
 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let hero of heroes; let i=index; let odd=odd; trackBy: trackById<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">[class.odd]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>odd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ({{i}}) {{hero.name}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-template</span> <span class="token attr-name">ngFor</span> <span class="token attr-name">let-hero</span> <span class="token attr-name">[ngForOf]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroes<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">let-i</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">let-odd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>odd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[ngForTrackBy]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>trackById<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[class.odd]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>odd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ({{i}}) {{hero.name}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最常见的场景是使用 * ngIf 和 * ngFor。例如，假设我们有一个项目列表，但是只有当某个条件为 true 时，才需要显示每个项目。我们可能会尝试这样的做法:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 但是，由于 *ngFor 和 *ngIf 都是结构指令，因此编译器会将其视为错误。你只能将一个 结构 指令应用于一个元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.isValid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ item.name }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 使用&lt;ng-container&gt; 或 &lt;ng-template&gt;效果相同--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of items<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.isValid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      {{ item.name }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>用 <code>*ngFor</code> 的 <code>trackBy</code> 跟踪条目</strong>(类似:key)</p> <p>使用 <code>*ngFor</code> 的 <code>trackBy</code> 属性，Angular 只能更改和重新渲染已更改的条目，而不必重新加载整个条目列表</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- trackByItems为组件内部定义的属性 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of items; trackBy: trackByItems<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ({{item.id}}) {{item.name}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">trackByItems</span><span class="token punctuation">(</span>index<span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">item</span><span class="token operator">:</span> Item<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p><strong>为没有 DOM 元素的指令安排宿主</strong></p> <p>Angular 的 <code>&lt;ng-container&gt;</code> 是一个分组元素，它不会干扰样式或布局，因为 Angular 不会将其放置在 DOM 中。</p> <p>当没有单个元素承载指令时，可以使用 <code>&lt;ng-container&gt;</code>。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  I turned the corner
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    and saw {{hero.name}}. I waved
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
  and continued on my way.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用场景：有条件地显示下拉框选项（原生下拉框）</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  Pick your favorite hero
  (<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span> <span class="token attr-name">(change)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showSad = !showSad<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>show sad<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">[(ngModel)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let h of heroes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showSad || h.emotion !== 'sad'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">[ngValue]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>h<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{h.name}} ({{h.emotion}})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/vuepress-notes/assets/img/angular2.55725ecc.png" alt="image-20230104163151402"></p> <p><strong><code>ngSwitch</code></strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[ngSwitch]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem.feature<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-stout-item</span>    <span class="token attr-name">*ngSwitchCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>stout'<span class="token punctuation">&quot;</span></span>    <span class="token attr-name">[item]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-stout-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-device-item</span>   <span class="token attr-name">*ngSwitchCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>slim'<span class="token punctuation">&quot;</span></span>     <span class="token attr-name">[item]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-device-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-lost-item</span>     <span class="token attr-name">*ngSwitchCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>vintage'<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">[item]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-lost-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-best-item</span>     <span class="token attr-name">*ngSwitchCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>bright'<span class="token punctuation">&quot;</span></span>   <span class="token attr-name">[item]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-best-item</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- . . . --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-unknown-item</span>  <span class="token attr-name">*ngSwitchDefault</span>           <span class="token attr-name">[item]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-unknown-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="创建结构性指令"><a href="#创建结构性指令" class="header-anchor">#</a> <strong>创建结构性指令</strong></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> TemplateRef<span class="token punctuation">,</span> ViewContainerRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token comment">//UnlessDirective 会通过 Angular 生成的 &lt;ng-template&gt; 创建一个嵌入的视图，然后将该视图插入到该指令的原始 &lt;p&gt; 宿主元素紧后面的视图容器中。</span>

<span class="token comment">//TemplateRef可帮助你获取 &lt;ng-template&gt; 的内容，而 ViewContainerRef 可以访问视图容器。</span>

@<span class="token function">Directive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">'[appUnless]'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UnlessDirective</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> hasView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">templateRef</span><span class="token operator">:</span> TemplateRef<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token literal-property property">viewContainer</span><span class="token operator">:</span> ViewContainerRef</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">appUnless</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">condition</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>condition <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>hasView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>viewContainer<span class="token punctuation">.</span><span class="token function">createEmbeddedView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>templateRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hasView <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hasView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>viewContainer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hasView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 星号是将 appUnless 标记为结构型指令的简写形式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">*appUnless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>condition<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unless a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  (A) This paragraph is displayed because the condition is false.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">*appUnless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!condition<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unless b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  (B) Although the condition is true,
  this paragraph is displayed because appUnless is set to false.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="服务与依赖注入"><a href="#服务与依赖注入" class="header-anchor">#</a> 服务与依赖注入</h2> <h3 id="服务"><a href="#服务" class="header-anchor">#</a> 服务</h3> <p>明确定义了用途的<strong>类</strong>，服务和组件分开，以提高模块性和复用性。</p> <p><strong>服务器获取数据</strong>、<strong>验证用户输入</strong>或<strong>直接往控制台中写日志</strong>等工作委托给各种服务</p> <p>服务也可以依赖其它服务</p> <p>创建服务：</p> <div class="language-js extra-class"><pre class="language-js"><code>ng generate service User
</code></pre></div><h3 id="提供服务"><a href="#提供服务" class="header-anchor">#</a> 提供服务</h3> <p>默认情况下，它会为该服务创建一个提供者，指定 Angular 应该在<strong>根注入器</strong>中提供该服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">providedIn</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="依赖注入"><a href="#依赖注入" class="header-anchor">#</a> 依赖注入</h3> <p>依赖项注入（DI）是一种设计模式，在这种设计模式中，类会从外部源请求依赖项而不是创建它们。Angular 的 DI 框架会在实例化某个类时为其提供依赖。</p> <p><img src="/vuepress-notes/assets/img/angular3.d7c0fc86.png" alt="image-20230302112648926"></p> <ul><li><p><strong>注入器</strong></p> <p>Angular 会在启动过程中为你创建全应用级注入器以及所需的其它注入器。你不用自己创建注入器。</p></li> <li><p><strong>容器</strong></p> <p>注入器创建依赖，容器维护依赖，并尽可能复用它们</p></li> <li><p><strong>提供者</strong></p> <p>一个对象，用来告诉注入器应该如何获取或创建依赖</p></li></ul> <p>Angular 可以把<strong>服务</strong>作为<strong>依赖</strong>注入到组件中</p> <p><strong>依赖不一定是服务 —— 它还可能是函数或值</strong></p> <p>当 Angular <strong>创建组件类的新实例</strong>时，它会通过查看该组件类的构造函数，来决定该组件依赖哪些服务或其它依赖项</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过查看该组件类的构造函数，来决定依赖</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">service</span><span class="token operator">:</span> HeroService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="提供服务-2"><a href="#提供服务-2" class="header-anchor">#</a> 提供服务</h4> <p>对于要用到的任何服务，你必须至少注册一个<strong>提供者</strong></p> <p>服务可以在自己的元数据中把自己注册为提供者，这样可以让自己随处可用</p> <p>在服务中注册提供者</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册提供者 </span>
<span class="token comment">// 在服务的 @Injectable()装饰器 中提供元数据</span>
<span class="token comment">// 或模块的 @NgModule()装饰器 中提供元数据</span>
<span class="token comment">// 或组件的 @Component()装饰器 中提供元数据</span>

<span class="token comment">// 服务的提供者被注册到根注入器中</span>
@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 <span class="token literal-property property">providedIn</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这种在 <code>@Injectable</code> 元数据中注册提供者的方式还让 Angular 能够通过移除那些从未被用过的服务来优化大小</p> <p>在模块中注册提供者</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">providers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  BackendService<span class="token punctuation">,</span>
  Logger
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 …
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在组件中注册提供者</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span>    <span class="token string">'app-hero-list'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">templateUrl</span><span class="token operator">:</span> <span class="token string">'./hero-list.component.html'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">providers</span><span class="token operator">:</span>  <span class="token punctuation">[</span> HeroService <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="注入服务"><a href="#注入服务" class="header-anchor">#</a> 注入服务</h4> <p>注入某些服务会使它们对组件可见。</p> <p>要将依赖项注入组件的 <code>constructor()</code> 中，请提供具有此依赖项类型的构造函数参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在构造函数中指定了heroService的类型为HeroService</span>
<span class="token function">constructor</span><span class="token punctuation">(</span>heroService<span class="token operator">:</span> HeroService<span class="token punctuation">)</span>
</code></pre></div><h4 id="服务中使用服务"><a href="#服务中使用服务" class="header-anchor">#</a> 服务中使用服务</h4> <p>例如<code>HeroService</code> 要依靠 <code>Logger</code> 服务来报告其活动</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//导入Logger服务</span>
<span class="token comment">//在HeroService的构造函数中注入Logger服务</span>
<span class="token comment">//之后会把Logger的实例存储在名为logger的私有字段</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HEROES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./mock-heroes'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../logger.service'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">providedIn</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroService</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token literal-property property">logger</span><span class="token operator">:</span> Logger</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>

  <span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting heroes ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">HEROES</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="定义提供者"><a href="#定义提供者" class="header-anchor">#</a> 定义提供者</h4> <p>https://angular.cn/guide/dependency-injection-in-action#defining-providers</p> <p>代替类 <strong><code>useClass</code></strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>providers<span class="token operator">:</span> <span class="token punctuation">[</span>Logger<span class="token punctuation">]</span>

<span class="token comment">// 将 Logger 扩展为一个完整的提供者对象</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> Logger<span class="token punctuation">,</span> useClass<span class="token operator">:</span> Logger <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><ul><li><code>provide</code> 属性存有<a href="https://angular.cn/guide/dependency-injection-providers#token" target="_blank" rel="noopener noreferrer">令牌<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它作为一个 key，在定位依赖值和配置注入器时使用。</li> <li>第二个属性是一个提供者定义对象，它告诉注入器要如何创建依赖值。提供者定义对象中的 key 可以是 <code>useClass</code> —— 就像这个例子中一样。也可以是 <code>useExisting</code>、<code>useValue</code> 或 <code>useFactory</code>。每一个 key 都用于提供一种不同类型的依赖，我们稍后会讨论。</li></ul> <p>代替类、别名类、对象、工厂函数</p> <h4 id="别名类提供者"><a href="#别名类提供者" class="header-anchor">#</a> 别名类提供者</h4> <p><strong><code>useExisting</code></strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">[</span> NewLogger<span class="token punctuation">,</span>
  <span class="token comment">// OldLogger 就成了 NewLogger 的别名。</span>
  <span class="token punctuation">{</span> provide<span class="token operator">:</span> OldLogger<span class="token punctuation">,</span> useExisting<span class="token operator">:</span> NewLogger<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>在 TypeScript 里面，类声明的顺序是很重要的。如果一个类尚未定义，就不能引用它。</p> <p>当使用父组件作为提供者时，就会形成类<em>A 引用类 B</em>，同时'B'引用'A'的困境；或者是当一个类<em>需要<strong>引用自身</strong></em>的时候</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> Parent<span class="token punctuation">,</span> useExisting<span class="token operator">:</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> AlexComponent<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="为多个类接口指定别名"><a href="#为多个类接口指定别名" class="header-anchor">#</a> 为多个类接口指定别名</h4> <div class="language-tsx extra-class"><pre class="language-tsx"><code>providers<span class="token operator">:</span>  <span class="token punctuation">[</span> <span class="token function">provideParent</span><span class="token punctuation">(</span>BethComponent<span class="token punctuation">,</span> DifferentParent<span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">provideParent</span>
  <span class="token punctuation">(</span>component<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> parentType<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> provide<span class="token operator">:</span> parentType <span class="token operator">||</span> Parent<span class="token punctuation">,</span> useExisting<span class="token operator">:</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> component<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>使用别名接口来窄化 API</strong></p> <p>想象 <code>LoggerService</code> 有个很大的 API 接口，远超过现有的三个方法和一个属性。你可能希望把 API 接口收窄到只有两个你确实需要的成员.</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">{</span> provide<span class="token operator">:</span> MinimalLogger<span class="token punctuation">,</span> useExisting<span class="token operator">:</span> LoggerService <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// Class used as a &quot;narrowing&quot; interface that exposes a minimal logger</span>
<span class="token comment">// Other members of the actual implementation are invisible</span>
<span class="token comment">// 在注入的依赖中只能看见两个成员</span>
<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MinimalLogger</span> <span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> logs<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">abstract</span> <span class="token function-variable function">logInfo</span><span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="注入对象"><a href="#注入对象" class="header-anchor">#</a> 注入对象</h4> <p><strong><code>useValue</code></strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> Logger<span class="token punctuation">,</span> useValue<span class="token operator">:</span> SilentLogger <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// An object in the shape of the logger service</span>
<span class="token keyword">function</span> <span class="token function">silentLoggerFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> SilentLogger <span class="token operator">=</span> <span class="token punctuation">{</span>
  logs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Silent logger says &quot;Shhhhh!&quot;. Provided via &quot;useValue&quot;'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  log<span class="token operator">:</span> silentLoggerFn
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">{</span> provide<span class="token operator">:</span> Hero<span class="token punctuation">,</span>          useValue<span class="token operator">:</span>    someHero <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">TITLE</span><span class="token punctuation">,</span>         useValue<span class="token operator">:</span>   <span class="token string">'Hero of the Month'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>第一处提供了用于 <code>Hero</code> 令牌的 <code>Hero</code> 类的<strong>现有实例</strong>，而不是要求注入器使用 <code>new</code> 来创建一个新实例或使用它自己的缓存实例。这里令牌就是这个类本身。</li> <li>第二处为 <code>TITLE</code> 令牌指定了一个字符串字面量资源。<code>TITLE</code> 提供者的令牌<em>不是一个类</em>，而是一个特别的提供者查询键，名叫<a href="https://angular.cn/guide/dependency-injection-in-action#injection-token" target="_blank" rel="noopener noreferrer">InjectionToken<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，表示一个 <code>InjectionToken</code> 实例。</li></ul> <blockquote><p>一个<em>值-提供者</em>的值必须在指定之前定义，其它类型的提供者都会<em>惰性创建</em>它们的值，也就是说只在需要注入它们的时候才创建</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> someHero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hero</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'Magma'</span><span class="token punctuation">,</span> <span class="token string">'Had a great month!'</span><span class="token punctuation">,</span> <span class="token string">'555-555-5555'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong><code>InjectionToken</code></strong></p> <p>可以定义和使用一个 <code>InjectionToken</code> 对象来为<strong>非类的依赖</strong>选择一个提供者令牌</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> InjectionToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">APP_CONFIG</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InjectionToken<span class="token operator">&lt;</span>AppConfig<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code>providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">APP_CONFIG</span><span class="token punctuation">,</span> useValue<span class="token operator">:</span> <span class="token constant">HERO_DI_CONFIG</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function">constructor</span><span class="token punctuation">(</span>@<span class="token function">Inject</span><span class="token punctuation">(</span><span class="token constant">APP_CONFIG</span><span class="token punctuation">)</span> config<span class="token operator">:</span> AppConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> config<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>由于 Angular 在运行期没有接口，所以该<strong>接口</strong>不能作为令牌，也不能注入它</p></blockquote> <h4 id="工厂提供者"><a href="#工厂提供者" class="header-anchor">#</a> 工厂提供者</h4> <p>要想根据运行前尚不可用的信息创建可变的依赖值，可以使用工厂提供者</p> <p>在下面的例子中，只有授权用户才能看到 <code>HeroService</code> 中的秘密英雄。授权可能在单个应用会话期间发生变化</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function">constructor</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> logger<span class="token operator">:</span> Logger<span class="token punctuation">,</span>
  <span class="token keyword">private</span> isAuthorized<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthorized <span class="token operator">?</span> <span class="token string">'authorized '</span> <span class="token operator">:</span> <span class="token string">'unauthorized'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getting heroes for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>auth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> user.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token constant">HEROES</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>hero <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthorized <span class="token operator">||</span> <span class="token operator">!</span>hero<span class="token punctuation">.</span>isSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">heroServiceFactory</span> <span class="token operator">=</span> <span class="token punctuation">(</span>logger<span class="token operator">:</span> Logger<span class="token punctuation">,</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">HeroService</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> userService<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isAuthorized<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>useFactory</code> 字段指定该提供者是一个工厂函数，其实现代码是 <code>heroServiceFactory</code></li> <li><code>deps</code> 属性是一个<a href="https://angular.cn/guide/dependency-injection-providers#token" target="_blank" rel="noopener noreferrer">提供者令牌<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>数组。<code>Logger</code> 和 <code>UserService</code> 类都是自己类提供者的令牌。该注入器解析了这些令牌，并把相应的服务注入到 <code>heroServiceFactory</code> 工厂函数的参数中。</li></ul> <h2 id="多级注入器"><a href="#多级注入器" class="header-anchor">#</a> 多级注入器</h2> <table><thead><tr><th style="text-align:left;">注入器层次结构</th> <th style="text-align:left;">详细信息</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>ModuleInjector</code> 层次结构</td> <td style="text-align:left;">使用 <code>@NgModule()</code> 或 <code>@Injectable()</code> 注解在此层次结构中配置 <code>ModuleInjector</code>。</td></tr> <tr><td style="text-align:left;"><code>ElementInjector</code> 层次结构</td> <td style="text-align:left;">在每个 DOM 元素上隐式创建。默认情况下，<code>ElementInjector</code> 是空的，除非你在 <code>@Directive()</code> 或 <code>@Component()</code> 的 <code>providers</code> 属性中配置它。</td></tr></tbody></table> <p><code>ModuleInjector</code></p> <ul><li>使用 <code>@Injectable()</code> 的 <code>providedIn</code> 属性引用 <code>@NgModule()</code> 或 <code>root</code></li> <li>使用 <code>@NgModule()</code> 的 <code>providers</code> 数组</li></ul> <blockquote><p>使用 <code>@Injectable()</code> 的 <code>providedIn</code> 属性优于 <code>@NgModule()</code> 的 <code>providers</code> 数组。使用 <code>@Injectable()</code> 的 <code>providedIn</code> 时，优化工具可以进行<strong>摇树优化</strong>，从而删除你的应用程序中未使用的服务，以减小捆绑包尺寸。</p></blockquote> <p><code>ElementInjector</code></p> <p>Angular 会为每个 DOM 元素隐式创建 <code>ElementInjector</code>。</p> <p>可以用 <code>@Component()</code> 装饰器中的 <code>providers</code> 或 <code>viewProviders</code> 属性来配置 <code>ElementInjector</code> 以提供服务</p> <p>组件和指令都可使用<code>providers</code>属性注册提供者</p> <p><img src="/vuepress-notes/assets/img/angular4.307c231d.png" alt="注入器层次"></p> <h3 id="解析规则"><a href="#解析规则" class="header-anchor">#</a> 解析规则</h3> <p>组件声明依赖 -&gt; 查找组件自身<code>ElementInjector</code> -&gt; 往上级<code>ElementInjector</code>上查找 -&gt; 未查找到则返回发起请求的元素，并在 <code>ModuleInjector</code> 层次结构中进行查找 -&gt; 找不到则引发错误</p> <blockquote><p>如果你已在不同级别注册了相同 DI 令牌的提供者，则 Angular 会用遇到的第一个来解析该依赖</p></blockquote> <h3 id="解析修饰符"><a href="#解析修饰符" class="header-anchor">#</a> 解析修饰符</h3> <ul><li>如果 Angular 找不到你要的东西该怎么办，用 <code>@Optional()</code></li> <li>从哪里开始寻找，用 <code>@SkipSelf()</code></li> <li>到哪里停止寻找，用 <code>@Host()</code> 和 <code>@Self()</code></li></ul> <p><strong><code>@Optional()</code></strong></p> <p>允许 Angular 将你注入的服务视为可选服务，如果无法在运行时解析它，Angular 只会将服务解析为 <code>null</code>，而不会抛出错误。</p> <p><strong><code>@Self()</code></strong></p> <p>使用 <code>@Self()</code> 让 Angular 仅查看当前组件或指令的 <code>ElementInjector</code>。</p> <p>通常与<code>@Optional</code>连用，例如要注入某个服务，但该服务只有在当前宿主元素上可用</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-self-no-data'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'./self-no-data.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./self-no-data.component.css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SelfNoDataComponent</span> <span class="token punctuation">{</span>
    <span class="token comment">// 即时有父提供者，但@Self 和 @Optional 在当前宿主元素上未找到就返回null</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>@<span class="token function">Self</span><span class="token punctuation">(</span><span class="token punctuation">)</span> @<span class="token function">Optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> leaf<span class="token operator">?</span><span class="token operator">:</span> LeafService<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>@SkipSelf()</code></strong></p> <p>从父<code>ElementInjector</code>中开始查找服务，跳过自身</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token comment">// 连用@SkipSelf() 和 @Optional() Person服务为null时防止报错</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>@<span class="token function">Optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> @<span class="token function">SkipSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> parent<span class="token operator">?</span><span class="token operator">:</span> Person<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>@Host</code></strong></p> <p><code>@Host()</code> 使你可以在搜索提供者时将当前组件指定为注入器树的最后一站。即使树的更上级有一个服务实例，Angular 也不会继续寻找。</p> <p><code>@Host</code> 属性装饰器会禁止在<em>宿主组件</em>以上的搜索。宿主组件通常就是请求该依赖的那个组件。不过，当该组件投影进某个<em>父</em>组件时，那个父组件就会变成宿主。</p> <p>会查找到当前组件和上级组件之间的 <strong><code>&lt;#view&gt;</code> 边缘</strong></p> <p><code>providers</code></p> <p><code>viewProviders</code> : 对于内容投影不可见</p> <p>参考<a href="https://angular.cn/guide/hierarchical-dependency-injection#providing-services-in-component" target="_blank" rel="noopener noreferrer">案例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/vuepress-notes/assets/img/angular5.71a6bb29.png" alt="image-20230303154401907"></p> <h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <p>路由器会把类似 URL 的路径映射到视图而不是页面,路由器拦截了浏览器的这个行为，并显示或隐藏一个视图层次结构</p> <p>路由器会在浏览器的历史日志中记录这个动作，所以前进和后退按钮也能正常工作。</p> <p><code>ActivatedRoute</code> 和 <code>Router</code></p> <h3 id="导入"><a href="#导入" class="header-anchor">#</a> 导入</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RouterModule<span class="token punctuation">,</span> Routes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>

<span class="token comment">// 通过 RouterModule.forRoot() 方法配置路由</span>
<span class="token comment">// 在子模块中使用 forChild() 配置</span>
@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    RouterModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>
      appRoutes<span class="token punctuation">,</span>
      <span class="token punctuation">{</span> enableTracing<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token comment">// &lt;-- debugging purposes only</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// other imports here</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>如果你需要查看导航生命周期中发生了什么事件，可以把 <code>enableTracing</code> 选项作为路由器默认配置的一部分。这会把每个导航生命周期中发生的每个路由器事件都输出到浏览器控制台中。<code>enableTracing</code> 只会用于调试目的。你可以把 <code>enableTracing: true</code> 选项作为第二个参数传给 <code>RouterModule.forRoot()</code> 方法。</p></blockquote> <h3 id="路由出口"><a href="#路由出口" class="header-anchor">#</a> 路由出口</h3> <p>参考<a href="https://angular.cn/api/router/RouterOutlet#description" target="_blank" rel="noopener noreferrer">RouterOutlet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>left<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>right<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="命名出口-outlet-显示多重路由"><a href="#命名出口-outlet-显示多重路由" class="header-anchor">#</a> 命名出口（outlet）显示多重路由</h3> <p>模板还可以有多个命名的路由出口。每个命名出口都自己有一组带组件的路由。多重出口可以在同一时间根据不同的路由来显示不同的内容。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[@routeAnimation]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getAnimationData()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popup<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>添加第二路由</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'compose'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> ComposeMessageComponent<span class="token punctuation">,</span>
  outlet<span class="token operator">:</span> <span class="token string">'popup'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token operator">&lt;</span>a <span class="token punctuation">[</span>routerLink<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;[{ outlets: { popup: ['compose'] } }]&quot;</span><span class="token operator">&gt;</span>Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>***<a href="https://angular.cn/api/router/RouterLink#description" target="_blank" rel="noopener noreferrer">链接参数数组<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><em><strong>包含一个只有一个 <code>outlets</code> 属性的对象，它的值是另一个对象，这个对象以一个或多个路由的出口名作为属性名。在这里，它只有一个出口名<code>popup</code>，它的值则是另一个***链接参数数组</strong></em>，用于指定 <code>compose</code> 路由。</p> <p>第二路由导航期间会合并路由</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>…<span class="token operator">/</span>crisis<span class="token operator">-</span><span class="token function">center</span><span class="token punctuation">(</span>popup<span class="token operator">:</span>compose<span class="token punctuation">)</span>
</code></pre></div><p><strong>清除第二路由</strong></p> <p>每个第二出口都有自己独立的导航，跟主出口的导航彼此独立。修改主出口中的当前路由并不会影响到 <code>popup</code> 出口中的。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function">closePopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> outlets<span class="token operator">:</span> <span class="token punctuation">{</span> popup<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="路由链接"><a href="#路由链接" class="header-anchor">#</a> 路由链接</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token operator">&lt;</span>a <span class="token punctuation">[</span>routerLink<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;['/crisis-center', { foo: 'foo' }]&quot;</span> routerLinkActive<span class="token operator">=</span><span class="token string">&quot;active&quot;</span> <span class="token operator">&gt;</span>Crisis Center<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// 是否显示到对应name为 popup 的路由出口上，显示的组件路径为 ompose</span>
<span class="token comment">// /superheroes(popup:compose) 辅助路由</span>
<span class="token operator">&lt;</span>a <span class="token punctuation">[</span>routerLink<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;[{ outlets: { popup: ['compose'] } }]&quot;</span><span class="token operator">&gt;</span>Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>routerLinkActive</code>跟踪元素上的链接路由当前是否处于活动状态，并允许你指定一个或多个 CSS 类，以便在链接路由处于活动状态时添加到该元素。</p> <p><code>routerLinkActive</code>可作用于祖先元素，当该祖先元素下的任意routerLink处于激活状态时，该祖先元素都将获得<code>routerLinkActive</code>指定的css类</p> <p>你可以通过传入 <code>exact: true</code> 来配置 RouterLinkActive。这样，只有当 url 和此链接精确匹配时才会添加这些类。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token operator">&lt;</span>a routerLink<span class="token operator">=</span><span class="token string">&quot;/user/bob&quot;</span> routerLinkActive<span class="token operator">=</span><span class="token string">&quot;active-link&quot;</span> <span class="token punctuation">[</span>routerLinkActiveOptions<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;{exact:true}&quot;</span><span class="token operator">&gt;</span>Bob<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="路由状态"><a href="#路由状态" class="header-anchor">#</a> 路由状态</h3> <p>每个成功的导航生命周期结束后，路由器都会构建一个 <strong><code>ActivatedRoute</code> 对象树</strong>，它构成了路由器的当前状态。你可以从任何地方使用应用的 <code>Router</code> 服务和 <code>routerState</code> 属性来访问当前的 <code>RouterState</code>。</p> <p><code>RouterState</code> 中的每个 <code>ActivatedRoute</code> 都提供了向上或向下遍历路由树的方法，用于从父路由、子路由和兄弟路由中获取信息。</p> <p>路由的路径和参数可以通过注入名为 <a href="https://angular.cn/api/router/ActivatedRoute" target="_blank" rel="noopener noreferrer">ActivatedRoute<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的路由服务获得。它提供了大量有用的信息，包括：https://angular.cn/guide/router-reference#activated-route</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>url</code></td> <td style="text-align:left;">一个路由路径的 <code>Observable</code>，是一个由路由路径的各个部分组成的字符串数组。</td></tr> <tr><td style="text-align:left;"><code>data</code></td> <td style="text-align:left;">包含提供给当前路由的 <code>data</code> 对象的 <code>Observable</code>。也包含任何由<a href="https://angular.cn/guide/router-tutorial-toh#resolve-guard" target="_blank" rel="noopener noreferrer">解析守卫<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>解析出的值。</td></tr> <tr><td style="text-align:left;"><code>params</code></td> <td style="text-align:left;"><code>Observable</code> 可以包含此路由的必选和<a href="https://angular.cn/guide/router-tutorial-toh#optional-route-parameters" target="_blank" rel="noopener noreferrer">可选参数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</td></tr> <tr><td style="text-align:left;"><code>paramMap</code></td> <td style="text-align:left;">一个包含该路由的必要参数和<a href="https://angular.cn/guide/router-tutorial-toh#optional-route-parameters" target="_blank" rel="noopener noreferrer">可选参数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://angular.cn/api/router/ParamMap" target="_blank" rel="noopener noreferrer">map<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <code>Observable</code>。这个 map 支持从同一个参数中获得单个或多个值。</td></tr> <tr><td style="text-align:left;"><code>queryParamMap</code></td> <td style="text-align:left;">一个包含适用于所有路由的<a href="https://angular.cn/guide/router-tutorial-toh#query-parameters" target="_blank" rel="noopener noreferrer">查询参数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://angular.cn/api/router/ParamMap" target="_blank" rel="noopener noreferrer">map<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <code>Observable</code>。这个 map 支持从同一个查询参数中获得单个或多个值。</td></tr> <tr><td style="text-align:left;"><code>queryParams</code></td> <td style="text-align:left;"><code>Observable</code> 可以包含对所有路由都可用的<a href="https://angular.cn/guide/router-tutorial-toh#query-parameters" target="_blank" rel="noopener noreferrer">查询参数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</td></tr> <tr><td style="text-align:left;"><code>fragment</code></td> <td style="text-align:left;">一个适用于所有路由的 URL <a href="https://angular.cn/guide/router-tutorial-toh#fragment" target="_blank" rel="noopener noreferrer">片段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的 <code>Observable</code>。</td></tr> <tr><td style="text-align:left;"><code>outlet</code></td> <td style="text-align:left;">用来渲染该路由的 <code>RouterOutlet</code> 的名字。对于无名出口，这个出口的名字是 <code>primary</code>。</td></tr> <tr><td style="text-align:left;"><code>routeConfig</code></td> <td style="text-align:left;">包含原始路径的那个路由的配置信息。</td></tr> <tr><td style="text-align:left;"><code>parent</code></td> <td style="text-align:left;">当该路由是<a href="https://angular.cn/guide/router-tutorial-toh#child-routing-component" target="_blank" rel="noopener noreferrer">子路由<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，表示该路由的父级 <code>ActivatedRoute</code>。</td></tr> <tr><td style="text-align:left;"><code>firstChild</code></td> <td style="text-align:left;">包含该路由的子路由列表中的第一个 <code>ActivatedRoute</code>。</td></tr> <tr><td style="text-align:left;"><code>children</code></td> <td style="text-align:left;">包含当前路由下所有激活的<a href="https://angular.cn/guide/router-tutorial-toh#child-routing-component" target="_blank" rel="noopener noreferrer">子路由<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</td></tr></tbody></table> <h3 id="路由器事件"><a href="#路由器事件" class="header-anchor">#</a> 路由器事件</h3> <p><code>Router</code> 在每次导航过程中都会通过 <code>Router.events</code> 属性发出导航事件。这些事件如下表所示。</p> <table><thead><tr><th style="text-align:left;">路由事件</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://angular.cn/api/router/NavigationStart" target="_blank" rel="noopener noreferrer"><code>NavigationStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">开始导航时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/RouteConfigLoadStart" target="_blank" rel="noopener noreferrer"><code>RouteConfigLoadStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器<a href="https://angular.cn/guide/router-tutorial-toh#asynchronous-routing" target="_blank" rel="noopener noreferrer">惰性加载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>某个路由配置之前触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/RouteConfigLoadEnd" target="_blank" rel="noopener noreferrer"><code>RouteConfigLoadEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">某个路由惰性加载完毕后触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/RoutesRecognized" target="_blank" rel="noopener noreferrer"><code>RoutesRecognized</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器解析完 URL，并且识别出路由时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/GuardsCheckStart" target="_blank" rel="noopener noreferrer"><code>GuardsCheckStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器开始执行路由守卫时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ChildActivationStart" target="_blank" rel="noopener noreferrer"><code>ChildActivationStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器开始激活某个路由的子路由时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ActivationStart" target="_blank" rel="noopener noreferrer"><code>ActivationStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器开始激活某个路由时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/GuardsCheckEnd" target="_blank" rel="noopener noreferrer"><code>GuardsCheckEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器完全完成了路由守卫阶段时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ResolveStart" target="_blank" rel="noopener noreferrer"><code>ResolveStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器开始路由解析（Resolve）阶段时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ResolveEnd" target="_blank" rel="noopener noreferrer"><code>ResolveEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器成功完成了路由解析（Resolve）阶段时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ChildActivationEnd" target="_blank" rel="noopener noreferrer"><code>ChildActivationEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器激活完某个路由的子路由时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/ActivationEnd" target="_blank" rel="noopener noreferrer"><code>ActivationEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">路由器正在激活某个路由时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/NavigationEnd" target="_blank" rel="noopener noreferrer"><code>NavigationEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">导航成功结束时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/NavigationCancel" target="_blank" rel="noopener noreferrer"><code>NavigationCancel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">导航被取消时触发。这可能是因为在导航期间某个<a href="https://angular.cn/guide/router-tutorial-toh#guards" target="_blank" rel="noopener noreferrer">路由守卫<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>返回了 false 或通过返回 <code>UrlTree</code> 而进行了重定向。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/NavigationError" target="_blank" rel="noopener noreferrer"><code>NavigationError</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">当导航因为非预期的错误而失败时触发。</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/Scroll" target="_blank" rel="noopener noreferrer"><code>Scroll</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">表示一个滚动事件。</td></tr></tbody></table> <h3 id="编程式导航"><a href="#编程式导航" class="header-anchor">#</a> 编程式导航</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroDetailComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> route<span class="token operator">:</span> ActivatedRoute<span class="token punctuation">,</span>
    <span class="token keyword">private</span> router<span class="token operator">:</span> Router<span class="token punctuation">,</span>
    <span class="token keyword">private</span> service<span class="token operator">:</span> HeroService
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
<span class="token operator">...</span>
<span class="token function">gotoHeroes</span><span class="token punctuation">(</span>hero<span class="token operator">:</span> Hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> heroId <span class="token operator">=</span> hero <span class="token operator">?</span> hero<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/superheroes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> heroId<span class="token punctuation">,</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="相对路由导航"><a href="#相对路由导航" class="header-anchor">#</a> 相对路由导航</h3> <p>若使用<strong>相对路由导航</strong>，在链接参数数组后面，添加一个带有 relativeTo 属性的对象，并把它设置为当前的 ActivatedRoute。这样路由器就会基于当前激活路由的位置来计算出目标 URL。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// /当前路由/team/33/user/11</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>relativeTo<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// /team</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'../team'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>relativeTo<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果用 <code>RouterLink</code> 来代替 <code>Router</code> 服务进行导航，就要使用相同的链接参数数组，不过不再需要提供 <code>relativeTo</code> 属性。<code>ActivatedRoute</code> 已经隐含在了 <code>RouterLink</code> 指令中。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">[routerLink]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>['../']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="路由守卫"><a href="#路由守卫" class="header-anchor">#</a> 路由守卫</h3> <p><code>Route</code></p> <p><code>canLoad</code> <code>canActivate</code> <code>canActivate</code></p> <p>使用场景：</p> <ul><li>该用户可能无权导航到目标组件</li> <li>可能用户得先登录（认证）</li> <li>在显示目标组件前，你可能得先获取某些数据</li> <li>在离开组件前，你可能要先保存修改</li> <li>你可能要询问用户：你是否要放弃本次更改，而不用保存它们？</li></ul> <p>可在路由配置中添加守卫</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> appRoutes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./admin/admin.module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>AdminModule<span class="token punctuation">)</span><span class="token punctuation">,</span>
    canLoad<span class="token operator">:</span> <span class="token punctuation">[</span>authGuard<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// auth.guard.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>inject<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  CanActivateFn<span class="token punctuation">,</span> CanMatchFn<span class="token punctuation">,</span>
  Router<span class="token punctuation">,</span> UrlTree
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>AuthService<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.service'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> authGuard<span class="token operator">:</span> CanMatchFn<span class="token operator">|</span><span class="token function-variable function">CanActivateFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用 inject 注入服务</span>
  <span class="token keyword">const</span> authService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>AuthService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>authService<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Redirect to the login page</span>
  <span class="token keyword">return</span> router<span class="token punctuation">.</span><span class="token function">parseUrl</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">守卫接口</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://angular.cn/api/router/CanActivateFn" target="_blank" rel="noopener noreferrer"><code>canActivate</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">导航***到***某路由时介入</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/CanActivateChildFn" target="_blank" rel="noopener noreferrer"><code>canActivateChild</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">导航***到***某个子路由时介入</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/CanDeactivateFn" target="_blank" rel="noopener noreferrer"><code>canDeactivate</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">从当前路由***离开***时介入</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/Resolve" target="_blank" rel="noopener noreferrer"><code>resolve</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">在某路由激活***之前***获取路由数据</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/CanLoadFn" target="_blank" rel="noopener noreferrer"><code>canLoad</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">导航到某个异步加载的特性模块时介入</td></tr> <tr><td style="text-align:left;"><a href="https://angular.cn/api/router/CanMatchFn" target="_blank" rel="noopener noreferrer"><code>canMatch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">控制是否应该使用 <code>Route</code> ，即使 <code>path</code> 与 URL 段匹配。</td></tr></tbody></table> <p>路由器从最深的子路由<strong>从下往上</strong>检查<code>canDeactivate()</code>守卫</p> <p>然后<strong>从上往下</strong>检查 ，若是异步加载的特性模块 ， 先检查<code>canLoad()</code> 守卫    后检查 <code>canLoad()</code>守卫</p> <p>除 <code>canMatch</code> 之外，如果<em>任何</em>一个守卫返回 <code>false</code>，其它尚未完成的守卫会被取消，这样整个导航就被取消了。</p> <table><thead><tr><th style="text-align:left;">守卫返回的值</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">导航过程会继续</td></tr> <tr><td style="text-align:left;"><code>false</code></td> <td style="text-align:left;">导航过程就会终止，且用户留在原地。</td></tr> <tr><td style="text-align:left;"><code>UrlTree</code></td> <td style="text-align:left;">取消当前导航，并开始导航到所返回的 <code>UrlTree</code></td></tr></tbody></table> <blockquote><p>守卫可以同步方式返回一个Boolean，但大多数情况会以异步方式返回，路由的守卫可以返回一个 <strong><code>Observable&lt;boolean&gt;</code> 或 <code>Promise&lt;boolean&gt;</code></strong>，并且路由器会等待这个可观察对象被解析为 <code>true</code> 或 <code>false</code>。提供给 <code>Router</code> 的可观察对象会在接收到第一个值之后<strong>自动完成</strong>（complete）。</p></blockquote> <p><strong>预先获取组件数据<code>resolve</code></strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> crisisCenterRoutes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> CrisisCenterComponent<span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> CrisisListComponent<span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">':id'</span><span class="token punctuation">,</span>
            component<span class="token operator">:</span> CrisisDetailComponent<span class="token punctuation">,</span>
            canDeactivate<span class="token operator">:</span> <span class="token punctuation">[</span>canDeactivateGuard<span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token comment">// 在路由配置中添加resolve属性</span>
            resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
              crisis<span class="token operator">:</span> crisisDetailResolver
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            component<span class="token operator">:</span> CrisisCenterHomeComponent
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>inject<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ActivatedRouteSnapshot<span class="token punctuation">,</span> ResolveFn<span class="token punctuation">,</span> Router<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">EMPTY</span><span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>delay<span class="token punctuation">,</span> mergeMap<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>Crisis<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./crisis'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>CrisisService<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./crisis.service'</span><span class="token punctuation">;</span>

<span class="token comment">// https://angular.cn/api/router/ResolveFn</span>
<span class="token comment">// 返回一个Observable&lt;Crisis&gt; Promise&lt;Crisis&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> crisisDetailResolver<span class="token operator">:</span> ResolveFn<span class="token operator">&lt;</span>Crisis<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cs <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>CrisisService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> route<span class="token punctuation">.</span>paramMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> cs<span class="token punctuation">.</span><span class="token function">getCrisis</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span>crisis <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>crisis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>crisis<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// id not found</span>
        router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/crisis-center'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">EMPTY</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p><code>NavigationExtras</code>导航时的查询参数和片段</p></blockquote> <h3 id="惰性加载模块"><a href="#惰性加载模块" class="header-anchor">#</a> 惰性加载模块</h3> <p><code>loadChildren</code> 属性接收一个函数，该函数使用浏览器内置的动态导入语法 <code>import('...')</code> 来惰性加载代码，并返回一个承诺（Promise）。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
    <span class="token comment">// 已登录且访问 /admin 时加载模块</span>
    <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./admin/admin.module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>AdminModule<span class="token punctuation">)</span><span class="token punctuation">,</span>
    canLoad<span class="token operator">:</span> <span class="token punctuation">[</span>authGuard<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="预加载"><a href="#预加载" class="header-anchor">#</a> 预加载</h3> <p>预加载允许你在后台加载模块，以便当用户激活某个特定的路由时，就可以渲染这些数据了</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    RouterModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>
      appRoutes<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        enableTracing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// &lt;-- debugging purposes only</span>
        preloadingStrategy<span class="token operator">:</span> SelectivePreloadingStrategyService<span class="token punctuation">,</span>
         <span class="token comment">//预加载器立即加载所有惰性加载路由（带 loadChildren 属性的路由）</span>
        <span class="token comment">//  preloadingStrategy: PreloadAllModules</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>
    RouterModule
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppRoutingModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>canLoad</code> 守卫的优先级高于预加载策略</p></blockquote> <p>自定义预加载策略</p> <p>在路由配置中设置<code>data.preload</code>标志</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'crisis-center'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./crisis-center/crisis-center.module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>CrisisCenterModule<span class="token punctuation">)</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span> preload<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// SelectivePreloadingStrategyService</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PreloadingStrategy<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SelectivePreloadingStrategyService</span> <span class="token keyword">implements</span> <span class="token class-name">PreloadingStrategy</span> <span class="token punctuation">{</span>
  preloadedModules<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">preload</span><span class="token punctuation">(</span>route<span class="token operator">:</span> Route<span class="token punctuation">,</span> <span class="token function-variable function">load</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 从route中获取预加载策略标志</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>data<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">'preload'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>path <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// add the route path to the preloaded module array</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>preloadedModules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// log the route path to the console</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Preloaded: '</span> <span class="token operator">+</span> route<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 满足条件则可以预加载</span>
      <span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>Router</code> 在每一层的路由配置中只会处理一次重定向。这样可以防止出现无限循环的重定向。</p></blockquote> <h3 id="路由动画"><a href="#路由动画" class="header-anchor">#</a> 路由动画</h3> <p>导入<a href="https://angular.cn/api/platform-browser/animations/BrowserAnimationsModule" target="_blank" rel="noopener noreferrer">BrowserAnimationsModule<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserAnimationsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/platform-browser/animations'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    BrowserAnimationsModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在使用动画的路由上定义添加一个 <code>data</code> 对象。 转场是基于 <a href="https://angular.cn/api/animations/state" target="_blank" rel="noopener noreferrer"><code>state</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的，你将使用来自路由的 <code>animation</code> 数据为转场提供一个有名字的动画 <code>state</code>。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> heroesRoutes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'superheroes'</span><span class="token punctuation">,</span>  component<span class="token operator">:</span> HeroListComponent<span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> animation<span class="token operator">:</span> <span class="token string">'heroes'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'superhero/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> HeroDetailComponent<span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> animation<span class="token operator">:</span> <span class="token string">'hero'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    RouterModule<span class="token punctuation">.</span><span class="token function">forChild</span><span class="token punctuation">(</span>heroesRoutes<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>
    RouterModule
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroesRoutingModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>定义动画 参考https://angular.cn/guide/animations</p> <ul><li>导出了一个名叫 <code>slideInAnimation</code> 的常量，并把它设置为一个名叫 <code>routeAnimation</code> 的动画触发器</li> <li>定义一个转场动画，当在 <code>heroes</code> 和 <code>hero</code> 路由之间来回切换时，如果进入（<code>:enter</code>）应用视图则让组件从屏幕的左侧滑入，如果离开（<code>:leave</code>）应用视图则让组件从右侧划出。</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  trigger<span class="token punctuation">,</span> animateChild<span class="token punctuation">,</span> group<span class="token punctuation">,</span>
  transition<span class="token punctuation">,</span> animate<span class="token punctuation">,</span> style<span class="token punctuation">,</span> query
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/animations'</span><span class="token punctuation">;</span>


<span class="token comment">// Routable animations</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> slideInAnimation <span class="token operator">=</span>
  <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'routeAnimation'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">'heroes &lt;=&gt; hero'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> position<span class="token operator">:</span> <span class="token string">'relative'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':enter, :leave'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
          top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> <span class="token string">'100%'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':enter'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token string">'-100%'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':leave'</span><span class="token punctuation">,</span> <span class="token function">animateChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':leave'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
          <span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">'300ms ease-out'</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':enter'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
          <span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">'300ms ease-out'</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token string">'0%'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">':enter'</span><span class="token punctuation">,</span> <span class="token function">animateChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为包含 <code>slideInAnimation</code> 的 <code>@Component</code> 元数据添加一个 <code>animations</code> 数组。</p> <div class="language-html extra-class"><pre class="language-html"><code>...
<span class="token comment">&lt;!-- 要想使用路由动画，就要把 RouterOutlet 包装到一个元素中。再把 @routeAnimation 触发器绑定到该元素上。 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">[@routeAnimation]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getAnimationData()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ChildrenOutletContexts <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> slideInAnimation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./animations'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-root'</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">'app.component.html'</span><span class="token punctuation">,</span>
  styleUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'app.component.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  animations<span class="token operator">:</span> <span class="token punctuation">[</span> slideInAnimation <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> contexts<span class="token operator">:</span> ChildrenOutletContexts<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">getRouteAnimationData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'primary'</span><span class="token punctuation">)</span><span class="token operator">?.</span>route<span class="token operator">?.</span>snapshot<span class="token operator">?.</span>data<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">'animation'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <table><thead><tr><th style="text-align:left;">路由器部件</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Router</code></td> <td style="text-align:left;">为活动 URL 显示应用中的组件。管理从一个组件到另一个的导航。</td></tr> <tr><td style="text-align:left;"><code>RouterModule</code></td> <td style="text-align:left;">一个单独的 NgModule，它提供了一些必要的服务提供者和一些用于在应用视图间导航的指令。</td></tr> <tr><td style="text-align:left;"><code>Routes</code></td> <td style="text-align:left;">定义一个路由数组，每一个条目都会把一个 URL 路径映射到组件。</td></tr> <tr><td style="text-align:left;"><code>Route</code></td> <td style="text-align:left;">定义路由器如何基于一个 URL 模式导航到某个组件。大部分路由都由一个路径和一个组件类组成。</td></tr> <tr><td style="text-align:left;"><code>RouterOutlet</code></td> <td style="text-align:left;">该指令 (<code>&lt;router-outlet&gt;</code>) 用于指出路由器应该把视图显示在哪里。</td></tr> <tr><td style="text-align:left;"><code>RouterLink</code></td> <td style="text-align:left;">用于将可点击的 HTML 元素绑定到某个路由的指令。单击带有 <code>routerLink</code> 指令且绑定到<em>字符串</em>或<em>链接参数数组</em>的元素，将触发导航。</td></tr> <tr><td style="text-align:left;"><code>RouterLinkActive</code></td> <td style="text-align:left;">当包含在元素上或内部的关联 <code>routerLink</code> 变为活动/非活动状态时，用于从 HTML 元素添加/删除类的指令。它还可以设置活动链接的 <code>aria-current</code> 以获得更好的无障碍性。</td></tr> <tr><td style="text-align:left;"><code>ActivatedRoute</code></td> <td style="text-align:left;">一个提供给每个路由组件的服务，其中包含当前路由专属的信息，比如路由参数、静态数据、解析数据、全局查询参数和全局片段。</td></tr> <tr><td style="text-align:left;"><code>RouterState</code></td> <td style="text-align:left;">路由器的当前状态，包括一棵当前激活路由的树以及遍历这棵路由树的便捷方法。</td></tr> <tr><td style="text-align:left;">链接参数数组</td> <td style="text-align:left;">一个由路由器将其解释为路由指南的数组。你可以将该数组绑定到 <code>RouterLink</code> 或将该数组作为参数传给 <code>Router.navigate</code> 方法。</td></tr> <tr><td style="text-align:left;">路由组件</td> <td style="text-align:left;">一个带有 <code>RouterOutlet</code> 的 Angular 组件，可基于路由器的导航来显示视图。</td></tr></tbody></table> <h2 id="表单"><a href="#表单" class="header-anchor">#</a> 表单</h2> <p><code>FormControl</code>和<code>FormGroup</code>是Angular中最基础的表单对象</p> <p><strong>当我们导入<code>FormsModule</code>时,<code>NgForm</code>会被自动附加到所有<code>&lt;form&gt;</code>标签上</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> FormsModule<span class="token punctuation">,</span>ReactiveFormsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/forms'</span>

<span class="token comment">// FormsModule提供指令ngModel NgForm</span>
<span class="token comment">// ReactiveFormsModule提供指令formContol ngFormGroup</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        FormsModule<span class="token punctuation">,</span>
        ReactiveFormsModule
    <span class="token punctuation">]</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>FormControl代表单一的输入字段,为Angular表单中的最小单元</p> <p>FormControl封装了字段的值和状态,比如是否有效,是否脏(是否被修改),是否有错误等.</p> <p>FormGroup用来管理多个FromControl</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> personInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firtname<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">'jin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FromControl</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">FromControl</span><span class="token punctuation">(</span><span class="token string">'18'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// FormControl、FormGroup都继承同一祖先AbstractControl,可使用下列属性检查表单的状态</span>
personInfo<span class="token punctuation">.</span>errors
personInfo<span class="token punctuation">.</span>dirty
personInfo<span class="token punctuation">.</span>valid
</code></pre></div><h3 id="模板表单"><a href="#模板表单" class="header-anchor">#</a> 模板表单</h3> <p>使用<code>[(ngModel)]</code> 和 <code>name</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'demo-form-sku'</span><span class="token punctuation">,</span>

  <span class="token comment">// ngForm对象由NgForm指令导出,是一个FormGroup类型;</span>
  <span class="token comment">// Ngform指令还提供ngSubmit输出事件</span>
  <span class="token comment">// 使用不带属性值的ngModel +　name=&quot;sku&quot; 会创建一个 FormControl对象并把它添加到父FormGroup上</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;div class=&quot;ui raised segment&quot;&gt;
    &lt;h2 class=&quot;ui header&quot;&gt;Demo Form: Sku&lt;/h2&gt;
    &lt;form #f=&quot;ngForm&quot;
          (ngSubmit)=&quot;onSubmit(f)&quot;
          class=&quot;ui form&quot;&gt;

      &lt;div class=&quot;field&quot;&gt;
        &lt;label for=&quot;skuInput&quot;&gt;SKU&lt;/label&gt;
        &lt;input type=&quot;text&quot;
               id=&quot;skuInput&quot;
               placeholder=&quot;SKU&quot;
               name=&quot;sku&quot; ngModel&gt;
      &lt;/div&gt;

      &lt;div class=&quot;field&quot;&gt;
        &lt;label for=&quot;sku1Input&quot;&gt;SKU1&lt;/label&gt;
        &lt;input type=&quot;text&quot;
               id=&quot;sku1Input&quot;
               placeholder=&quot;SKU&quot;
               name=&quot;sku1&quot; ngModel&gt;
      &lt;/div&gt;

      &lt;button type=&quot;submit&quot; class=&quot;ui button&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DemoFormSku</span> <span class="token punctuation">{</span>
  <span class="token function">onSubmit</span><span class="token punctuation">(</span>form<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'you submitted value:'</span><span class="token punctuation">,</span> form<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FormGroup:'</span><span class="token punctuation">,</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="frombuilder响应式表单"><a href="#frombuilder响应式表单" class="header-anchor">#</a> FromBuilder响应式表单</h3> <p>我们说过当引入<code>FormsModule</code>时,<code>NgForm</code>会自动应用于<code>&lt;form&gt;</code>,但有一例外:<code>NgForm</code>不会应用到带**<code>formGroup</code>属性**的<code>&lt;form&gt;</code>上.</p> <p>NgForm的选择器为:</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">form</span><span class="token punctuation">:</span><span class="token function">not</span><span class="token punctuation">(</span>[ngNoForm]<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">not</span><span class="token punctuation">(</span>[formGroup]<span class="token punctuation">)</span><span class="token punctuation">,</span>ngForm<span class="token punctuation">,</span>[ngForm]
</code></pre></div><p>这意味着当form标签存在属性ngNoForm时,form表单也不带NgForm指令</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  FormBuilder<span class="token punctuation">,</span>
  FormGroup
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/forms'</span><span class="token punctuation">;</span>

<span class="token comment">// 使用FormBuilder创建FormGroup,用formGroup属性应用于模板;</span>
<span class="token comment">// 使用formControl应用创建的FormControl</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'demo-form-sku-builder'</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;div class=&quot;ui raised segment&quot;&gt;
    &lt;h2 class=&quot;ui header&quot;&gt;Demo Form: Sku with Builder&lt;/h2&gt;
    &lt;form [formGroup]=&quot;myForm&quot; 
          (ngSubmit)=&quot;onSubmit(myForm.value)&quot;
          class=&quot;ui form&quot;&gt;

      &lt;div class=&quot;field&quot;&gt;
        &lt;label for=&quot;skuInput&quot;&gt;SKU&lt;/label&gt;
        &lt;input type=&quot;text&quot; 
               id=&quot;skuInput&quot; 
               placeholder=&quot;SKU&quot;
               [formControl]=&quot;myForm.controls['sku']&quot;&gt;
      &lt;/div&gt;

    &lt;button type=&quot;submit&quot; class=&quot;ui button&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 此处myForm.controls['sku']关联模板ts报错，this.myForm.controls['sku']为AbstractControl&lt;any,any&gt;类型,formControl指令接收一个FormControl&lt;any&gt;类型，可改用formControlName=&quot;sku&quot;关联模板</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DemoFormSkuBuilder</span> <span class="token punctuation">{</span>
  myForm<span class="token operator">:</span> FormGroup<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>fb<span class="token operator">:</span> FormBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//FormBuilder中常用的两个方法group,contol</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myForm <span class="token operator">=</span> fb<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">'sku'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ABC123'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">onSubmit</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'you submitted value: '</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总结:</p> <p>想要隐式创建<code>FormGroup</code>和<code>FormControl</code>,使用<code>ngForm</code> <code>ngModel</code> <code>name</code>;</p> <p>若绑定一个现有的<code>FormGroup</code>和<code>FormControl</code>,使用<code>formGroup</code> <code>formControl</code> <code>formControlName</code></p> <h3 id="嵌套表单组"><a href="#嵌套表单组" class="header-anchor">#</a> 嵌套表单组</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FormGroup<span class="token punctuation">,</span> FormControl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/forms'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'demo-form-nest'</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;form 
  [formGroup]=&quot;profileForm&quot; 
  (ngSubmit)=&quot;onSubmit()&quot;
  class=&quot;ui form&quot;&gt;
    &lt;label for=&quot;first-name&quot;&gt;First Name: &lt;/label&gt;
    &lt;input id=&quot;first-name&quot; type=&quot;text&quot; formControlName=&quot;firstName&quot; required&gt;

    &lt;label for=&quot;last-name&quot;&gt;Last Name: &lt;/label&gt;
    &lt;input id=&quot;last-name&quot; type=&quot;text&quot; formControlName=&quot;lastName&quot;&gt;
    
    &lt;div formGroupName=&quot;address&quot;&gt;
      &lt;h2&gt;Address&lt;/h2&gt;

      &lt;label for=&quot;street&quot;&gt;Street: &lt;/label&gt;
      &lt;input id=&quot;street&quot; type=&quot;text&quot; formControlName=&quot;street&quot;&gt;

      &lt;label for=&quot;city&quot;&gt;City: &lt;/label&gt;
      &lt;input id=&quot;city&quot; type=&quot;text&quot; formControlName=&quot;city&quot;&gt;

      &lt;label for=&quot;state&quot;&gt;State: &lt;/label&gt;
      &lt;input id=&quot;state&quot; type=&quot;text&quot; formControlName=&quot;state&quot;&gt;

      &lt;label for=&quot;zip&quot;&gt;Zip Code: &lt;/label&gt;
      &lt;input id=&quot;zip&quot; type=&quot;text&quot; formControlName=&quot;zip&quot;&gt;
    &lt;/div&gt;

    &lt;button type=&quot;submit&quot; class=&quot;ui button&quot; [disabled]=&quot;!profileForm.valid&quot;&gt;Submit&lt;/button&gt;
    &lt;button type=&quot;button&quot; (click)=&quot;updateProfile()&quot;&gt;Update Profile&lt;/button&gt;
  &lt;/form&gt;
  </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DemoFormNest</span><span class="token punctuation">{</span>
  profileForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      street<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      city<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      state<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      zip<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: Use EventEmitter with form value</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>profileForm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">updateProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>profileForm<span class="token punctuation">.</span><span class="token function">patchValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        firstName<span class="token operator">:</span> <span class="token string">'Nancy'</span><span class="token punctuation">,</span>
        address<span class="token operator">:</span> <span class="token punctuation">{</span>
          street<span class="token operator">:</span> <span class="token string">'123 Drew Street'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="更新部分数据模型"><a href="#更新部分数据模型" class="header-anchor">#</a> 更新部分数据模型</h4> <p>当修改包含多个 <code>FormGroup</code> 实例的值时，你可能只希望更新模型中的一部分，而不是完全替换掉</p> <p>有两种更新模型值的方式：</p> <table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">详情</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>setValue()</code></td> <td style="text-align:left;">使用 <code>setValue()</code> 方法来为单个控件设置新值。<code>setValue()</code> 方法会严格遵循表单组的结构，并整体性替换控件的值。</td></tr> <tr><td style="text-align:left;"><code>patchValue()</code></td> <td style="text-align:left;">用此对象中定义的任意属性对表单模型进行替换。</td></tr></tbody></table> <p><code>setValue()</code> 方法的严格检查可以帮助你捕获复杂表单嵌套中的错误，而 <code>patchValue()</code> 在遇到那些错误时可能会默默的失败</p> <h3 id="添加验证"><a href="#添加验证" class="header-anchor">#</a> 添加验证</h3> <p>模板驱动表单中添加验证</p> <p>把 <code>ngModel</code> 导出成局部模板变量来查看该控件的状态</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span>
      required minlength<span class="token operator">=</span><span class="token string">&quot;4&quot;</span> appForbiddenName<span class="token operator">=</span><span class="token string">&quot;bob&quot;</span>
      <span class="token punctuation">[</span><span class="token punctuation">(</span>ngModel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;hero.name&quot;</span> #name<span class="token operator">=</span><span class="token string">&quot;ngModel&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div <span class="token operator">*</span>ngIf<span class="token operator">=</span><span class="token string">&quot;name.invalid &amp;&amp; (name.dirty || name.touched)&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;alert&quot;</span><span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>div <span class="token operator">*</span>ngIf<span class="token operator">=</span><span class="token string">&quot;name.errors?.['required']&quot;</span><span class="token operator">&gt;</span>
    Name <span class="token keyword">is</span> required<span class="token punctuation">.</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token operator">*</span>ngIf<span class="token operator">=</span><span class="token string">&quot;name.errors?.['minlength']&quot;</span><span class="token operator">&gt;</span>
    Name must be at least <span class="token number">4</span> characters long<span class="token punctuation">.</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token operator">*</span>ngIf<span class="token operator">=</span><span class="token string">&quot;name.errors?.['forbiddenName']&quot;</span><span class="token operator">&gt;</span>
    Name cannot be Bob<span class="token punctuation">.</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h4 id="验证器-validator-函数"><a href="#验证器-validator-函数" class="header-anchor">#</a> 验证器（Validator）函数</h4> <table><thead><tr><th style="text-align:left;">验证器类型</th> <th style="text-align:left;">详细信息</th></tr></thead> <tbody><tr><td style="text-align:left;">同步验证器</td> <td style="text-align:left;">这些同步函数接受一个控件实例，然后返回一组验证错误或 <code>null</code>。可以在实例化一个 <code>FormControl</code> 时把它作为构造函数的第二个参数传进去。</td></tr> <tr><td style="text-align:left;">异步验证器</td> <td style="text-align:left;">这些异步函数接受一个控件实例并返回一个 Promise 或 Observable，它稍后会发出一组验证错误或 <code>null</code>。在实例化 <code>FormControl</code> 时，可以把它们作为第三个参数传入。</td></tr></tbody></table> <blockquote><p>出于性能方面的考虑，只有在所有同步验证器都通过之后，Angular 才会运行异步验证器。当每一个异步验证器都执行完之后，才会设置这些验证错误</p></blockquote> <p>Angular 的一些内置验证器:<a href="https://angular.cn/api/forms/Validators" target="_blank" rel="noopener noreferrer">验证器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="自定义验证器"><a href="#自定义验证器" class="header-anchor">#</a> 自定义验证器</h4> <p><strong>响应式表单添加自定义验证器</strong></p> <p>在响应式表单中，通过直接把该函数传给 <code>FormControl</code> 来添加自定义验证器。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">forbiddenNameValidator</span><span class="token punctuation">(</span>nameRe<span class="token operator">:</span> RegExp<span class="token punctuation">)</span><span class="token operator">:</span> ValidatorFn <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>control<span class="token operator">:</span> AbstractControl<span class="token punctuation">)</span><span class="token operator">:</span> ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接收一个控制器对象，并在验证错误时返回错误对象</span>
    <span class="token keyword">const</span> forbidden <span class="token operator">=</span> nameRe<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>control<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> forbidden <span class="token operator">?</span> <span class="token punctuation">{</span>forbiddenName<span class="token operator">:</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> control<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 使用FormBuilder.control 或 new FormControl() 传入验证器函数</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DemoFormWithValidationsReavctive</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
     <span class="token comment">// 所有这些验证器都是同步的，所以它们作为第二个参数传递,当作为第三个采纳数传递时，为异步验证器</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>fb<span class="token operator">:</span> FormBuilder<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heroForm <span class="token operator">=</span> fb<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> fb<span class="token punctuation">.</span><span class="token function">control</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">[</span>Validators<span class="token punctuation">.</span>required<span class="token punctuation">,</span>Validators<span class="token punctuation">.</span><span class="token function">minLength</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">forbiddenNameValidator</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bob</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

	<span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.heroForm = new FormGroup({</span>
    <span class="token comment">//   name: new FormControl(this.hero.name, [</span>
    <span class="token comment">//     Validators.required,</span>
    <span class="token comment">//     Validators.minLength(4),</span>
    <span class="token comment">//     forbiddenNameValidator(/bob/i)</span>
    <span class="token comment">//   ])</span>
    <span class="token comment">// })</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>模板驱动表单添加自定义验证器</strong></p> <p>为模板添加一个指令，该指令包含了 validator 函数</p> <p><code>NG_VALIDATORS</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Directive<span class="token punctuation">,</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AbstractControl<span class="token punctuation">,</span> <span class="token constant">NG_VALIDATORS</span><span class="token punctuation">,</span> ValidationErrors<span class="token punctuation">,</span> Validator<span class="token punctuation">,</span> ValidatorFn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/forms'</span><span class="token punctuation">;</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appForbiddenName]'</span><span class="token punctuation">,</span>
    <span class="token comment">// Angular 在验证过程中会识别出该指令的作用，因为该指令把自己注册成了 NG_VALIDATORS 提供者，如下例所示。NG_VALIDATORS 是一个带有可扩展验证器集合的预定义提供者。</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>provide<span class="token operator">:</span> <span class="token constant">NG_VALIDATORS</span><span class="token punctuation">,</span> useExisting<span class="token operator">:</span> ForbiddenValidatorDirective<span class="token punctuation">,</span> multi<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ForbiddenValidatorDirective</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Input</span></span><span class="token punctuation">(</span><span class="token string">'appForbiddenName'</span><span class="token punctuation">)</span> forbiddenName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

  <span class="token function">validate</span><span class="token punctuation">(</span>control<span class="token operator">:</span> AbstractControl<span class="token punctuation">)</span><span class="token operator">:</span> ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>forbiddenName <span class="token operator">?</span> <span class="token function">forbiddenNameValidator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>forbiddenName<span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>control<span class="token punctuation">)</span>
                              <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">required</span> <span class="token attr-name">minlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appForbiddenName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bob<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">[(ngModel)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero.name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">#name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ngModel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用ngModel导出到模板变量中，查看FormControl状态(valid,errors,invalid,dirty),touched</p> <h4 id="表示控件状态的类"><a href="#表示控件状态的类" class="header-anchor">#</a> 表示控件状态的类</h4> <p>Angular 会自动把很多控件属性作为 CSS 类映射到控件所在的元素上，使用这些类添加样式</p> <ul><li><code>.ng-valid</code></li> <li><code>.ng-invalid</code></li> <li><code>.ng-pending</code></li> <li><code>.ng-pristine</code></li> <li><code>.ng-dirty</code></li> <li><code>.ng-untouched</code></li> <li><code>.ng-touched</code></li> <li><code>.ng-submitted</code> (只对 form 元素添加)</li></ul> <h4 id="交叉验证表单字段"><a href="#交叉验证表单字段" class="header-anchor">#</a> <strong>交叉验证表单字段</strong></h4> <p>跨字段交叉验证器是一种<a href="https://angular.cn/guide/form-validation#custom-validators" target="_blank" rel="noopener noreferrer">自定义验证器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可以对表单中不同字段的值进行比较，并针对它们的组合进行接受或拒绝。例如选项不兼容的表单以便让用户选择 A 或 B，而不能两者都选。某些字段值也可能依赖于其它值；用户可能只有当选择了 A 之后才能选择 B</p> <p><strong>模板驱动表单创建交叉验证器</strong></p> <p>使用指令   <code>NG_VALIDATORS</code> <code>AbstractControl.get()</code>   最后在 <code>form</code>标签上使用改指令</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appIdentityRevealed]'</span><span class="token punctuation">,</span>
    <span class="token comment">// 使用 NG_VALIDATORS 令牌将指令提供为验证器</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">NG_VALIDATORS</span><span class="token punctuation">,</span> useExisting<span class="token operator">:</span> IdentityRevealedValidatorDirective<span class="token punctuation">,</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">IdentityRevealedValidatorDirective</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>
  <span class="token comment">//  必须创建一个指令来包装验证器函数</span>
  <span class="token function">validate</span><span class="token punctuation">(</span>control<span class="token operator">:</span> AbstractControl<span class="token punctuation">)</span><span class="token operator">:</span> ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">identityRevealedValidator</span><span class="token punctuation">(</span>control<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> identityRevealedValidator<span class="token operator">:</span> ValidatorFn <span class="token operator">=</span> <span class="token punctuation">(</span>control<span class="token operator">:</span> AbstractControl<span class="token punctuation">)</span><span class="token operator">:</span> ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 验证函数内部使用AbstractControl.get()方法获取子控件的值</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> control<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> alterEgo <span class="token operator">=</span> control<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'alterEgo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 两个控件的值相等，则返回错误对象</span>
  <span class="token keyword">return</span> name <span class="token operator">&amp;&amp;</span> alterEgo <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span>value <span class="token operator">===</span> alterEgo<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{</span> identityRevealed<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>响应式表单创建交叉验证器</p> <p>在创建表单时，以<a href="https://angular.cn/api/forms/FormGroup#constructor" target="_blank" rel="noopener noreferrer">FormGroup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第二,第三个参数传入 ,<a href="https://angular.cn/api/forms/FormControl#constructor" target="_blank" rel="noopener noreferrer">FormControl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>也可传入验证器</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//  forbiddenNameValidator identityRevealedValidator 为验证器函数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>heroForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        Validators<span class="token punctuation">.</span>required<span class="token punctuation">,</span>
        Validators<span class="token punctuation">.</span><span class="token function">minLength</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">forbiddenNameValidator</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bob</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      alterEgo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">'Dr. What'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>identityRevealedValidator<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="异步验证器"><a href="#异步验证器" class="header-anchor">#</a> 异步验证器</h4> <p><code>NG_ASYNC_VALIDATORS</code>注册成异步验证器指令</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> providedIn<span class="token operator">:</span> <span class="token string">'root'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UniqueAlterEgoValidator</span> <span class="token keyword">implements</span> <span class="token class-name">AsyncValidator</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> heroesService<span class="token operator">:</span> HeroesService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">validate</span><span class="token punctuation">(</span>
    control<span class="token operator">:</span> AbstractControl
  <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'[appUniqueAlterEgo]'</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">NG_ASYNC_VALIDATORS</span><span class="token punctuation">,</span>
      useExisting<span class="token operator">:</span> UniqueAlterEgoValidatorDirective<span class="token punctuation">,</span>
      <span class="token comment">// forwardRef所做的工作，就是接收一个函数作为参数，然后返回一个class，因为这个函数并不是立即被调用的，而是在UniqueAlterEgoValidatorDirective声明之后才会安全地返回UniqueAlterEgoValidatorDirective</span>
      <span class="token comment">// useExisting: forwardRef(() =&gt; UniqueAlterEgoValidatorDirective),</span>
      multi<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UniqueAlterEgoValidatorDirective</span> <span class="token keyword">implements</span> <span class="token class-name">AsyncValidator</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> validator<span class="token operator">:</span> UniqueAlterEgoValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 异步验证器，validate() 函数必须返回一个 Promise 或可观察对象，</span>
  <span class="token function">validate</span><span class="token punctuation">(</span>
    control<span class="token operator">:</span> AbstractControl
  <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>ValidationErrors <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>control<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>模板驱动表单添加异步验证器</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alterEgo<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">[(ngModel)]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hero.alterEgo<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alterEgo<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">#alterEgo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ngModel<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">[ngModelOptions]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ updateOn: 'blur' }<span class="token punctuation">&quot;</span></span> 
       <span class="token attr-name">appUniqueAlterEgo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>响应式表单添加异步验证器</strong></p> <p>注入验证器函数</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> alterEgoValidator<span class="token operator">:</span> UniqueAlterEgoValidator<span class="token punctuation">)</span>
</code></pre></div><p>将验证器函数直接传递给 <a href="https://angular.cn/api/forms/FormControl#constructor" target="_blank" rel="noopener noreferrer">FormControl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以应用它</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">this</span><span class="token punctuation">.</span>heroForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        Validators<span class="token punctuation">.</span>required<span class="token punctuation">,</span>
        Validators<span class="token punctuation">.</span><span class="token function">minLength</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">forbiddenNameValidator</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bob</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// </span>
      alterEgo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">FormControl</span><span class="token punctuation">(</span><span class="token string">'Dr. What'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        asyncValidators<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>alterEgoValidator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>alterEgoValidator<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        updateOn<span class="token operator">:</span> <span class="token string">'blur'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>identityRevealedValidator<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>你可以把 <code>updateOn</code> 属性从 <code>change</code>（默认值）改成 <code>submit</code> 或 <code>blur</code> 来推迟表单验证的更新时机</p> <h4 id="原生html表单验证"><a href="#原生html表单验证" class="header-anchor">#</a> 原生HTML表单验证</h4> <p><code>&lt;form&gt;</code> 元素上添加 <code>novalidate</code> 属性来禁用<a href="https://developer.mozilla.org/docs/Web/Guide/HTML/Constraint_validation" target="_blank" rel="noopener noreferrer">原生 HTML 表单验证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>原生验证与基于 Angular 的验证结合，<code>ngNativeValidate</code> 指令</p> <h3 id="监听变化"><a href="#监听变化" class="header-anchor">#</a> 监听变化</h3> <p>响应式表单：</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 表单字段</span>
FromControl<span class="token punctuation">.</span>valueChanges<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">:</span>sring<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 整个表单</span>
FromGroup<span class="token punctuation">.</span>valueChanges<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>模板驱动：</p> <p>使用<a href="https://angular.cn/api/core/ViewChild#description" target="_blank" rel="noopener noreferrer">@ViewChild视图查询<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>导入模板变量,视图查询在 <code>ngAfterViewInit</code> 钩子函数调用前完成</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>  @<span class="token function">ViewChild</span><span class="token punctuation">(</span><span class="token string">'heroForm'</span><span class="token punctuation">)</span>
  heroForm<span class="token operator">!</span><span class="token operator">:</span> FormGroup<span class="token punctuation">;</span>

 <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heroForm<span class="token punctuation">.</span>valueChanges<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Form change to:'</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>valueChanges<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name change to:'</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h2> <h3 id="jsonp请求"><a href="#jsonp请求" class="header-anchor">#</a> JSONP请求</h3> <p>当服务器不支持 <a href="https://developer.mozilla.org/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">CORS 协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，应用程序可以使用 <code>HttpClient</code> 跨域发出 <a href="https://en.wikipedia.org/wiki/JSONP" target="_blank" rel="noopener noreferrer">JSONP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 请求。HTTPClient.<a href="https://angular.cn/api/common/http/HttpClient#jsonp" target="_blank" rel="noopener noreferrer">jsonp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(url:string,callbackParam:string)</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token comment">/* GET heroes whose name contains search term */</span>
<span class="token function">searchHeroes</span><span class="token punctuation">(</span>term<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable <span class="token punctuation">{</span>
  term <span class="token operator">=</span> term<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> heroesURL <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroesURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>term<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span>heroesUrl<span class="token punctuation">,</span> <span class="token string">'callback'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token string">'searchHeroes'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// then handle the error</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="请求非json数据"><a href="#请求非json数据" class="header-anchor">#</a> 请求非JSON数据</h3> <p>不是所有的 API 都会返回 JSON 数据，HttpClient.<a href="https://angular.cn/api/common/http/HttpClient#get" target="_blank" rel="noopener noreferrer">get<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>http options参考https://angular.cn/api/common/http/HttpRequest#reportProgress</p> <p><a href="https://angular.cn/api/common/http/HttpRequest#responseType" target="_blank" rel="noopener noreferrer"><strong>responseType</strong>: 'arraybuffer' | 'blob' | 'json' | 'text'<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function">getTextFile</span><span class="token punctuation">(</span>filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The Observable returned by get() is of type Observable&lt;string&gt;</span>
  <span class="token comment">// because a text response was specified.</span>
  <span class="token comment">// There's no need to pass a &lt;string&gt; type parameter to get().</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{</span>responseType<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">tap</span><span class="token punctuation">(</span> <span class="token comment">// Log the result or error</span>
      <span class="token punctuation">{</span>
        <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">logError</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="post请求"><a href="#post请求" class="header-anchor">#</a> POST请求</h3> <p>其余请求类似，参考 <a href="https://angular.cn/api/common/http/HttpClient#post" target="_blank" rel="noopener noreferrer">API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>HttpClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">,</span>options<span class="token operator">:</span>object<span class="token punctuation">)</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">/** POST: add a new hero to the database */</span>
<span class="token function">addHero</span><span class="token punctuation">(</span>hero<span class="token operator">:</span> Hero<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>Hero<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroesUrl<span class="token punctuation">,</span> hero<span class="token punctuation">,</span> httpOptions<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token string">'addHero'</span><span class="token punctuation">,</span> hero<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="添加更新请求头"><a href="#添加更新请求头" class="header-anchor">#</a> 添加更新请求头</h3> <p><strong>添加请求头</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpHeaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> httpOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span>  <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    Authorization<span class="token operator">:</span> <span class="token string">'my-auth-token'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>不能直接修改前面的选项对象中的 <code>HttpHeaders</code> 请求头，因为 <code>HttpHeaders</code> 类的实例是不可变对象</p> <p><strong>更新请求头</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>httpOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span> httpOptions<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> <span class="token string">'my-new-auth-token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="url参数"><a href="#url参数" class="header-anchor">#</a> URL参数</h3> <p>使用 HttpParams.<a href="https://angular.cn/api/common/http/HttpParams#set" target="_blank" rel="noopener noreferrer">set<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://angular.cn/api/common/http/HttpParams#appendall" target="_blank" rel="noopener noreferrer">appendAll<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://angular.cn/api/common/http/HttpParams#append" target="_blank" rel="noopener noreferrer">append<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>     或者  直接在URL上拼接</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>HttpParams<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span><span class="token punctuation">;</span>


<span class="token comment">/* GET heroes whose name contains search term */</span>
<span class="token function">searchHeroes</span><span class="token punctuation">(</span>term<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  term <span class="token operator">=</span> term<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add safe, URL encoded search parameter if there is a search term</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> term <span class="token operator">?</span>
   <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> term<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 给现有参数添加新的值</span>
  <span class="token comment">// options.params = options.params?.append('age', 12);</span>
  <span class="token comment">// 传递多个参数</span>
  <span class="token comment">// options.params = options.params?.appendALL(params:{ name:'Dr',age:12 })</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroesUrl<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">handleError</span><span class="token generic class-name"><span class="token operator">&lt;</span>Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'searchHeroes'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HttpParams</code> 是不可变对象。如果需要更新选项，请保留 <code>.set()</code> 方法的返回值。</p> <p>你也可以使用 <code>fromString</code> 变量从查询字符串中直接创建 HTTP 参数：</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>fromString<span class="token operator">:</span> <span class="token string">'name=foo'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="请求拦截器"><a href="#请求拦截器" class="header-anchor">#</a> 请求拦截器</h3> <p>要实现拦截器，就要实现一个实现了 <code>HttpInterceptor</code> 接口中的 <code>intercept()</code> 方法的类。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  HttpEvent<span class="token punctuation">,</span> HttpInterceptor<span class="token punctuation">,</span> HttpHandler<span class="token punctuation">,</span> HttpRequest
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token comment">/** Pass untouched request through to the next request handler. */</span>
@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">NoopInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">// intercept方法会把请求转换成一个Observable&lt;HttpEvent&lt;any&gt;&gt;</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>req<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> next<span class="token operator">:</span> HttpHandler<span class="token punctuation">)</span><span class="token operator">:</span>
    Observable<span class="token operator">&lt;</span>HttpEvent<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// next对象表示拦截器链表中的下一个拦截器，中间件模式</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="提供拦截器"><a href="#提供拦截器" class="header-anchor">#</a> 提供拦截器</h4> <p>拦截器是一个特殊的服务，像其它服务一样，你也必须先提供这个拦截器类，应用才能使用它。</p> <p>由于拦截器是 <code>HttpClient</code> 服务的（可选）依赖，所以你必须在提供 <code>HttpClient</code> 的同一个（或其各级父注入器）注入器中提供这些拦截器。那些在 DI 创建完 <code>HttpClient</code> <em>之后</em>再提供的拦截器将会被忽略。</p> <p>在 <code>AppModule</code> 中导入了 <code>HttpClientModule</code>，导致本应用在其根注入器中提供了 <code>HttpClient</code>。所以你也同样要在 <code>AppModule</code> 中提供这些拦截器。</p> <p>将所有拦截器搜集起来，并把它加到 <code>AppModule</code> 的 <code>providers array</code> ，同时要注意拦截器顺序</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">/* &quot;Barrel&quot; of Http Interceptors */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HTTP_INTERCEPTORS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> NoopInterceptor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./noop-interceptor'</span><span class="token punctuation">;</span>

<span class="token comment">/** Http interceptor providers in outside-in order */</span>
<span class="token comment">// 注意 multi: true 选项。 这个必须的选项会告诉 Angular HTTP_INTERCEPTORS 是一个多重提供者的令牌，表示它会注入一个多值的数组，而不是单一的值。</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> httpInterceptorProviders <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token constant">HTTP_INTERCEPTORS</span><span class="token punctuation">,</span> useClass<span class="token operator">:</span> NoopInterceptor<span class="token punctuation">,</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// AppModule中提供</span>
providers<span class="token operator">:</span> <span class="token punctuation">[</span>
  httpInterceptorProviders
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="处理拦截器事件"><a href="#处理拦截器事件" class="header-anchor">#</a> 处理拦截器事件</h4> <p>虽然拦截器有能力改变请求和响应，但 <code>HttpRequest</code> 和 <code>HttpResponse</code> 实例的属性却是<strong>只读</strong>（<code>readonly</code>）的， 因此让它们基本上是不可变的。应用可能会重试发送很多次请求之后才能成功，这就意味着这个拦截器链表可能会多次重复处理同一个请求。 如果拦截器可以修改原始的请求对象，那么重试阶段的操作就会从修改过的请求开始，而不是原始请求。 而这种不可变性，可以确保这些拦截器在每次重试时看到的都是同样的原始请求。</p> <p><strong>修改请求体</strong>，先把它克隆一份，修改这个克隆体后再把它传给 <code>next.handle()</code></p> <p><code>readonly</code> 这种赋值保护，无法防范深修改（修改子对象的属性），也不能防范你修改请求体对象中的属性。</p> <ol><li>复制请求体并在副本中进行修改。</li> <li>使用 <code>clone()</code> 方法克隆这个请求对象。</li> <li>用修改过的副本替换被克隆的请求体。</li></ol> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// clone request and replace 'http://' with 'https://' at the same time</span>
<span class="token keyword">const</span> secureReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> <span class="token string">'https://'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// send the cloned, &quot;secure&quot; request to the next handler.</span>
<span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>secureReq<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>克隆时清除请求体</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>newReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> … <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// body not mentioned =&gt; preserve original body</span>
newReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> body<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保持原有请求体</span>
newReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> body<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除请求体</span>
</code></pre></div><h4 id="设置默认请求头"><a href="#设置默认请求头" class="header-anchor">#</a> 设置默认请求头</h4> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../auth.service'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> auth<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">intercept</span><span class="token punctuation">(</span>req<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> next<span class="token operator">:</span> HttpHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the auth token from the service.</span>
    <span class="token keyword">const</span> authToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>auth<span class="token punctuation">.</span><span class="token function">getAuthorizationToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Clone the request and replace the original headers with</span>
    <span class="token comment">// cloned headers, updated with the authorization.</span>
    <span class="token keyword">const</span> authReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> authToken<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      
      <span class="token comment">// 快捷方式设置</span>
    <span class="token keyword">const</span> authReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> setHeaders<span class="token operator">:</span> <span class="token punctuation">{</span> Authorization<span class="token operator">:</span> authToken <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// send cloned request with header to the next handler.</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>authReq<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="变更检测"><a href="#变更检测" class="header-anchor">#</a> 变更检测</h2> <p>Angular 的变化检测是指 Angular 框架自动检测组件的数据变化，并且在需要时更新视图。这个过程是通过比较组件当前状态和之前状态的差异来实现的。</p> <p>Angular 中的变化检测是基于 Zone.js 实现的。Zone.js 可以用来拦截所有的异步操作，包括 DOM 事件、定时器、Promise 等等，然后在异步操作结束后自动触发 Angular 的变化检测。</p> <p>Angular 的变化检测有两种模式：默认模式和OnPush模式。</p> <p>默认模式是指，当组件的某个数据发生变化时，Angular 框架会自动检测这个变化，并且更新组件的视图。这种模式下，每次变化检测都会遍历整个组件树，检查每个组件的数据状态。</p> <p>OnPush模式是指，当组件的某个输入属性发生变化时，Angular 框架会检测这个变化，并且更新组件的视图。但是，当组件的其他数据发生变化时，Angular 框架不会自动检测这个变化，需要手动调用 markForCheck() 方法来触发变化检测。这种模式下，只有当组件的输入属性发生变化时，才会遍历整个组件树，检查每个组件的数据状态。</p> <p>在 Angular 中，我们应该尽量减少变化检测的次数，因为变化检测是一个比较耗费性能的操作。可以通过使用 OnPush 模式、避免不必要的数据绑定、优化组件的结构等方式来减少变化检测的次数。</p> <p>在 Angular 中没有类似于 Vue 的 nextTick 方法。但是，Angular 中有一些类似的方法可以实现相同的功能。</p> <p>1.<strong><code>setTimeout</code>方法</strong></p> <p>setTimeout 方法可以在当前 JavaScript 任务队列执行完毕后执行回调函数，在 Angular 中也可以使用 setTimeout 方法来实现类似于 nextTick 的功能。</p> <p>例如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在下一个 JavaScript 任务队列中执行</span>
  <span class="token comment">// 这里可以对 DOM 进行操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2.<strong><code>ngZone.run</code>方法</strong></p> <p>ngZone 是 Angular 中的一个<strong>服务</strong>，可以用来管理 Angular 应用的变化检测和事件循环。ngZone.run 方法可以让一个函数在 Angular 的变化检测机制中执行，并且在下一个变化检测周期之前执行回调函数。</p> <p>例如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> ngZone<span class="token operator">:</span> NgZone<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>ngZone<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在下一个变化检测周期中执行</span>
  <span class="token comment">// 这里可以对 DOM 进行操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3.<code>ChangeDetectorRef.detectChanges</code> 方法</p> <p>ChangeDetectorRef 是 Angular 中的一个服务，可以用来手动触发变化检测。ChangeDetectorRef.detectChanges 方法可以在当前变化检测周期中执行回调函数，并且在下一个变化检测周期之前执行。</p> <p>例如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> cdr<span class="token operator">:</span> ChangeDetectorRef<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>cdr<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在当前变化检测周期中执行</span>
<span class="token comment">// 这里可以对 DOM 进行操作</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>cdr<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>需要注意的是，这种方法会触发整个组件树的变化检测，所以不要滥用。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#模块" class="sidebar-link reco-side-模块" data-v-b57cc07c>模块</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#ngmodule-元数据" class="sidebar-link reco-side-ngmodule-元数据" data-v-b57cc07c>@NgModule 元数据</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#ngmodule-和-javascript-的模块" class="sidebar-link reco-side-ngmodule-和-javascript-的模块" data-v-b57cc07c>NgModule 和 JavaScript 的模块</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#angular-自带的库" class="sidebar-link reco-side-angular-自带的库" data-v-b57cc07c>Angular 自带的库</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#组件" class="sidebar-link reco-side-组件" data-v-b57cc07c>组件</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#创建组件" class="sidebar-link reco-side-创建组件" data-v-b57cc07c>创建组件</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#组件的元数据" class="sidebar-link reco-side-组件的元数据" data-v-b57cc07c>组件的元数据</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#组件生命周期" class="sidebar-link reco-side-组件生命周期" data-v-b57cc07c>组件生命周期</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#视图封装" class="sidebar-link reco-side-视图封装" data-v-b57cc07c>视图封装</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#组件之间的交互" class="sidebar-link reco-side-组件之间的交互" data-v-b57cc07c>组件之间的交互</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#组件样式" class="sidebar-link reco-side-组件样式" data-v-b57cc07c>组件样式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#数据绑定" class="sidebar-link reco-side-数据绑定" data-v-b57cc07c>数据绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#管道" class="sidebar-link reco-side-管道" data-v-b57cc07c>管道</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#内容投影-vue插槽" class="sidebar-link reco-side-内容投影-vue插槽" data-v-b57cc07c>内容投影（vue插槽）</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#动态组件" class="sidebar-link reco-side-动态组件" data-v-b57cc07c>动态组件</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#angular元素" class="sidebar-link reco-side-angular元素" data-v-b57cc07c>angular元素</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#模板" class="sidebar-link reco-side-模板" data-v-b57cc07c>模板</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#插值" class="sidebar-link reco-side-插值" data-v-b57cc07c>插值</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#属性绑定" class="sidebar-link reco-side-属性绑定" data-v-b57cc07c>属性绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#类和样式绑定" class="sidebar-link reco-side-类和样式绑定" data-v-b57cc07c>类和样式绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#事件绑定" class="sidebar-link reco-side-事件绑定" data-v-b57cc07c>事件绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#属性绑定-2" class="sidebar-link reco-side-属性绑定-2" data-v-b57cc07c>属性绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#双向绑定" class="sidebar-link reco-side-双向绑定" data-v-b57cc07c>双向绑定</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#管道-2" class="sidebar-link reco-side-管道-2" data-v-b57cc07c>管道</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#模板变量" class="sidebar-link reco-side-模板变量" data-v-b57cc07c>模板变量</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#指令" class="sidebar-link reco-side-指令" data-v-b57cc07c>指令</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#内置属性型指令" class="sidebar-link reco-side-内置属性型指令" data-v-b57cc07c>内置属性型指令</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#创建属性型指令" class="sidebar-link reco-side-创建属性型指令" data-v-b57cc07c>创建属性型指令</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#内置结构型指令" class="sidebar-link reco-side-内置结构型指令" data-v-b57cc07c>内置结构型指令</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#创建结构性指令" class="sidebar-link reco-side-创建结构性指令" data-v-b57cc07c>创建结构性指令</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#服务与依赖注入" class="sidebar-link reco-side-服务与依赖注入" data-v-b57cc07c>服务与依赖注入</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#服务" class="sidebar-link reco-side-服务" data-v-b57cc07c>服务</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#提供服务" class="sidebar-link reco-side-提供服务" data-v-b57cc07c>提供服务</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#依赖注入" class="sidebar-link reco-side-依赖注入" data-v-b57cc07c>依赖注入</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#多级注入器" class="sidebar-link reco-side-多级注入器" data-v-b57cc07c>多级注入器</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#解析规则" class="sidebar-link reco-side-解析规则" data-v-b57cc07c>解析规则</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#解析修饰符" class="sidebar-link reco-side-解析修饰符" data-v-b57cc07c>解析修饰符</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由" class="sidebar-link reco-side-路由" data-v-b57cc07c>路由</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#导入" class="sidebar-link reco-side-导入" data-v-b57cc07c>导入</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由出口" class="sidebar-link reco-side-路由出口" data-v-b57cc07c>路由出口</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#命名出口-outlet-显示多重路由" class="sidebar-link reco-side-命名出口-outlet-显示多重路由" data-v-b57cc07c>命名出口（outlet）显示多重路由</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由链接" class="sidebar-link reco-side-路由链接" data-v-b57cc07c>路由链接</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由状态" class="sidebar-link reco-side-路由状态" data-v-b57cc07c>路由状态</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由器事件" class="sidebar-link reco-side-路由器事件" data-v-b57cc07c>路由器事件</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#编程式导航" class="sidebar-link reco-side-编程式导航" data-v-b57cc07c>编程式导航</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#相对路由导航" class="sidebar-link reco-side-相对路由导航" data-v-b57cc07c>相对路由导航</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由守卫" class="sidebar-link reco-side-路由守卫" data-v-b57cc07c>路由守卫</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#惰性加载模块" class="sidebar-link reco-side-惰性加载模块" data-v-b57cc07c>惰性加载模块</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#预加载" class="sidebar-link reco-side-预加载" data-v-b57cc07c>预加载</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#路由动画" class="sidebar-link reco-side-路由动画" data-v-b57cc07c>路由动画</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#表单" class="sidebar-link reco-side-表单" data-v-b57cc07c>表单</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#模板表单" class="sidebar-link reco-side-模板表单" data-v-b57cc07c>模板表单</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#frombuilder响应式表单" class="sidebar-link reco-side-frombuilder响应式表单" data-v-b57cc07c>FromBuilder响应式表单</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#嵌套表单组" class="sidebar-link reco-side-嵌套表单组" data-v-b57cc07c>嵌套表单组</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#添加验证" class="sidebar-link reco-side-添加验证" data-v-b57cc07c>添加验证</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#监听变化" class="sidebar-link reco-side-监听变化" data-v-b57cc07c>监听变化</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#http" class="sidebar-link reco-side-http" data-v-b57cc07c>HTTP</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#jsonp请求" class="sidebar-link reco-side-jsonp请求" data-v-b57cc07c>JSONP请求</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#请求非json数据" class="sidebar-link reco-side-请求非json数据" data-v-b57cc07c>请求非JSON数据</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#post请求" class="sidebar-link reco-side-post请求" data-v-b57cc07c>POST请求</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#添加更新请求头" class="sidebar-link reco-side-添加更新请求头" data-v-b57cc07c>添加更新请求头</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#url参数" class="sidebar-link reco-side-url参数" data-v-b57cc07c>URL参数</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#请求拦截器" class="sidebar-link reco-side-请求拦截器" data-v-b57cc07c>请求拦截器</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-notes/src/font/angular.html#变更检测" class="sidebar-link reco-side-变更检测" data-v-b57cc07c>变更检测</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:-1;" data-v-248d85d6></canvas></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/vuepress-notes/assets/js/app.0e02cffb.js" defer></script><script src="/vuepress-notes/assets/js/3.314e4ca8.js" defer></script><script src="/vuepress-notes/assets/js/1.db3018c9.js" defer></script><script src="/vuepress-notes/assets/js/8.617d334c.js" defer></script>
  </body>
</html>
